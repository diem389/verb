/*! verb 2019-10-04 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).verb=e()}}(function(){var r=this,e=(new Function("try {return this===window;}catch(e){ return false;}"),new Function("try {return this===global;}catch(e){return false;}")),t=new Function("try {return typeof importScripts === 'function';}catch(e){return false;}");if(e()&&!t()&&(Worker=require("webworker-threads").Worker),e()||t()){var n=r;if(t()){onmessage=function(e){if(e.data.className&&e.data.methodName){var t=function(e,t){var n=r;return e.split(".").forEach(function(e){n=n&&n[e]}),n?n[t]:null}(e.data.className,e.data.methodName);if(!t)return console.error("could not find "+e.data.className+"."+e.data.methodName);postMessage({result:t.apply(null,e.data.args),id:e.data.id})}}}}return function(n,r){"use strict";if(!n.setImmediate){var e,i,t,o,a=1,s={},u=!1,l=n.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(n);h=h&&h.setTimeout?h:n,e="[object process]"==={}.toString.call(n.process)?function(){var e=c(arguments);return process.nextTick(f(v,e)),e}:function(){if(n.postMessage&&!n.importScripts){var e=!0,t=n.onmessage;return n.onmessage=function(){e=!1},n.postMessage("","*"),n.onmessage=t,e}}()?(o="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",d,!1):n.attachEvent("onmessage",d),function(){var e=c(arguments);return n.postMessage(o+e,"*"),e}):n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){v(e.data)},function(){var e=c(arguments);return t.port2.postMessage(e),e}):l&&"onreadystatechange"in l.createElement("script")?(i=l.documentElement,function(){var e=c(arguments),t=l.createElement("script");return t.onreadystatechange=function(){v(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t),e}):function(){var e=c(arguments);return setTimeout(f(v,e),0),e},h.setImmediate=e,h.clearImmediate=_}function c(e){return s[a]=f.apply(r,e),a++}function f(e){var t=[].slice.call(arguments,1);return function(){"function"==typeof e?e.apply(r,t):new Function(""+e)()}}function v(e){if(u)setTimeout(f(v,e),0);else{var t=s[e];if(t){u=!0;try{t()}finally{_(e),u=!1}}}}function _(e){delete s[e]}function d(e){e.source===n&&"string"==typeof e.data&&0===e.data.indexOf(o)&&v(+e.data.slice(o.length))}}(new Function("return this")()),function(e,t){"use strict";e.geom=e.geom||{},e.exe=e.exe||{},e.eval=e.eval||{},e.core=e.core||{},e.promhx=e.promhx||{};function n(){return W.__string_rec(this,"")}var r={};function i(e,t){function n(){}n.prototype=e;var r=new n;for(var i in t)r[i]=t[i];return t.toString!==Object.prototype.toString&&(r.toString=t.toString),r}function J(){}(r.HxOverrides=J).__name__=["HxOverrides"],J.strDate=function(e){switch(e.length){case 8:var t=e.split(":"),n=new Date;return n.setTime(0),n.setUTCHours(t[0]),n.setUTCMinutes(t[1]),n.setUTCSeconds(t[2]),n;case 10:var r=e.split("-");return new Date(r[0],r[1]-1,r[2],0,0,0);case 19:var i=e.split(" "),o=i[0].split("-"),a=i[1].split(":");return new Date(o[0],o[1]-1,o[2],a[0],a[1],a[2]);default:throw new se("Invalid date format : "+e)}},J.cca=function(e,t){var n=e.charCodeAt(t);if(n==n)return n},J.substr=function(e,t,n){if(null==n)n=e.length;else if(n<0){if(0!=t)return"";n=e.length+n}return e.substr(t,n)},J.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};function N(){}(r.Lambda=N).__name__=["Lambda"],N.fold=function(e,t,n){for(var r=nt(e)();r.hasNext();){n=t(r.next(),n)}return n};function ee(){this.length=0}(r.List=ee).__name__=["List"],ee.prototype={add:function(e){var t=new o(e,null);null==this.h?this.h=t:this.q.next=t,this.q=t,this.length++},pop:function(){if(null==this.h)return null;var e=this.h.item;return this.h=this.h.next,null==this.h&&(this.q=null),this.length--,e},isEmpty:function(){return null==this.h},iterator:function(){return new a(this.h)},__class__:ee};var o=function(e,t){this.item=e,this.next=t};(r["_List.ListNode"]=o).__name__=["_List","ListNode"],o.prototype={__class__:o};var a=function(e){this.head=e};(r["_List.ListIterator"]=a).__name__=["_List","ListIterator"],a.prototype={hasNext:function(){return null!=this.head},next:function(){var e=this.head.item;return this.head=this.head.next,e},__class__:a},Math.__name__=["Math"];function q(){}(r.Reflect=q).__name__=["Reflect"],q.field=function(e,t){try{return e[t]}catch(e){return null}},q.fields=function(e){var t=[];if(null!=e){var n=Object.prototype.hasOwnProperty;for(var r in e)"__id__"!=r&&"hx__closures__"!=r&&n.call(e,r)&&t.push(r)}return t},q.isFunction=function(e){return"function"==typeof e&&!(e.__name__||e.__ename__)},q.deleteField=function(e,t){return!!Object.prototype.hasOwnProperty.call(e,t)&&(delete e[t],!0)};function G(){}(r.Std=G).__name__=["Std"],G.string=function(e){return W.__string_rec(e,"")};function s(){this.b=""}(r.StringBuf=s).__name__=["StringBuf"],s.prototype={__class__:s};var u=r.ValueType={__ename__:["ValueType"],__constructs__:["TNull","TInt","TFloat","TBool","TObject","TFunction","TClass","TEnum","TUnknown"]};u.TNull=["TNull",0],u.TNull.toString=n,(u.TNull.__enum__=u).TInt=["TInt",1],u.TInt.toString=n,(u.TInt.__enum__=u).TFloat=["TFloat",2],u.TFloat.toString=n,(u.TFloat.__enum__=u).TBool=["TBool",3],u.TBool.toString=n,(u.TBool.__enum__=u).TObject=["TObject",4],u.TObject.toString=n,(u.TObject.__enum__=u).TFunction=["TFunction",5],u.TFunction.toString=n,(u.TFunction.__enum__=u).TClass=function(e){var t=["TClass",6,e];return t.__enum__=u,t.toString=n,t},u.TEnum=function(e){var t=["TEnum",7,e];return t.__enum__=u,t.toString=n,t},u.TUnknown=["TUnknown",8],u.TUnknown.toString=n,u.TUnknown.__enum__=u;function te(){}(r.Type=te).__name__=["Type"],te.getClassName=function(e){var t=e.__name__;return null==t?null:t.join(".")},te.getEnumName=function(e){return e.__ename__.join(".")},te.resolveClass=function(e){var t=r[e];return null!=t&&t.__name__?t:null},te.resolveEnum=function(e){var t=r[e];return null!=t&&t.__ename__?t:null},te.createEmptyInstance=function(e){function t(){}return t.prototype=e.prototype,new t},te.createEnum=function(e,t,n){var r=q.field(e,t);if(null==r)throw new se("No such constructor "+t);if(q.isFunction(r)){if(null==n)throw new se("Constructor "+t+" need parameters");return r.apply(e,n)}if(null!=n&&0!=n.length)throw new se("Constructor "+t+" does not need parameters");return r},te.typeof=function(e){switch(typeof e){case"boolean":return u.TBool;case"function":return e.__name__||e.__ename__?u.TObject:u.TFunction;case"number":return Math.ceil(e)==e%2147483648?u.TInt:u.TFloat;case"object":if(null==e)return u.TNull;var t=e.__enum__;if(null!=t)return u.TEnum(t);var n=W.getClass(e);return null!=n?u.TClass(n):u.TObject;case"string":return u.TClass(String);case"undefined":return u.TNull;default:return u.TUnknown}};function l(){}(r["haxe.IMap"]=l).__name__=["haxe","IMap"];var K=function(){this.buf=new s,this.cache=[],this.useCache=K.USE_CACHE,this.useEnumIndex=K.USE_ENUM_INDEX,this.shash=new oe,this.scount=0};(r["haxe.Serializer"]=K).__name__=["haxe","Serializer"],K.prototype={toString:function(){return this.buf.b},serializeString:function(e){var t=this.shash,n=null!=ft[e]?t.getReserved(e):t.h[e];if(null!=n)return this.buf.b+="R",void(this.buf.b+=null==n?"null":""+n);var r=this.shash,i=this.scount++;null!=ft[e]?r.setReserved(e,i):r.h[e]=i,this.buf.b+="y",e=encodeURIComponent(e),this.buf.b+=G.string(e.length),this.buf.b+=":",this.buf.b+=null==e?"null":""+e},serializeRef:function(e){for(var t=typeof e,n=0,r=this.cache.length;n<r;){var i=n++,o=this.cache[i];if(typeof o==t&&o==e)return this.buf.b+="r",this.buf.b+=null==i?"null":""+i,!0}return this.cache.push(e),!1},serializeFields:function(e){for(var t=0,n=q.fields(e);t<n.length;){var r=n[t];++t,this.serializeString(r),this.serialize(q.field(e,r))}this.buf.b+="g"},serialize:function(e){var t=te.typeof(e);switch(t[1]){case 0:this.buf.b+="n";break;case 1:var n=e;if(0==n)return void(this.buf.b+="z");this.buf.b+="i",this.buf.b+=null==n?"null":""+n;break;case 2:var r=e;isNaN(r)?this.buf.b+="k":isFinite(r)?(this.buf.b+="d",this.buf.b+=null==r?"null":""+r):this.buf.b+=r<0?"m":"p";break;case 3:this.buf.b+=e?"t":"f";break;case 4:if(W.__instanceof(e,ht)){var i=te.getClassName(e);this.buf.b+="A",this.serializeString(i)}else if(W.__instanceof(e,ct))this.buf.b+="B",this.serializeString(te.getEnumName(e));else{if(this.useCache&&this.serializeRef(e))return;this.buf.b+="o",this.serializeFields(e)}break;case 5:throw new se("Cannot serialize function");case 6:var o=t[2];if(o==String)return void this.serializeString(e);if(this.useCache&&this.serializeRef(e))return;switch(o){case Array:var a=0;this.buf.b+="a";for(var s=0,u=e.length;s<u;){var l=s++;null==e[l]?++a:(0<a&&(1==a?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==a?"null":""+a),a=0),this.serialize(e[l]))}0<a&&(1==a?this.buf.b+="n":(this.buf.b+="u",this.buf.b+=null==a?"null":""+a)),this.buf.b+="h";break;case Date:var h=e;this.buf.b+="v",this.buf.b+=G.string(h.getTime());break;case ee:this.buf.b+="l";for(var c=e.h;null!=c;){var f=c.item;c=c.next;var v=f;this.serialize(v)}this.buf.b+="h";break;case re:this.buf.b+="q";for(var _=e,d=_.keys();d.hasNext();){var p=d.next();this.buf.b+=":",this.buf.b+=null==p?"null":""+p,this.serialize(_.h[p])}this.buf.b+="h";break;case ie:this.buf.b+="M";for(var m=e,g=m.keys();g.hasNext();){var b=g.next(),y=q.field(b,"__id__");q.deleteField(b,"__id__"),this.serialize(b),b.__id__=y,this.serialize(m.h[b.__id__])}this.buf.b+="h";break;case oe:this.buf.b+="b";for(var w=e,S=w.keys();S.hasNext();){var k=S.next();this.serializeString(k),this.serialize(null!=ft[k]?w.getReserved(k):w.h[k])}this.buf.b+="h";break;case ae:var P=e;this.buf.b+="s",this.buf.b+=G.string(Math.ceil(8*P.length/6)),this.buf.b+=":";var x=0,C=P.length-2,M=K.BASE64_CODES;if(null==M){var N=K.BASE64.length;M=new Array(N);for(var A=0,z=K.BASE64.length;A<z;){var E=A++;M[E]=J.cca(K.BASE64,E)}K.BASE64_CODES=M}for(;x<C;){var I=P.b[x++],L=P.b[x++],T=P.b[x++];this.buf.b+=String.fromCharCode(M[I>>2]),this.buf.b+=String.fromCharCode(M[63&(I<<4|L>>4)]),this.buf.b+=String.fromCharCode(M[63&(L<<2|T>>6)]),this.buf.b+=String.fromCharCode(M[63&T])}if(x==C){var B=P.b[x++],U=P.b[x++];this.buf.b+=String.fromCharCode(M[B>>2]),this.buf.b+=String.fromCharCode(M[63&(B<<4|U>>4)]),this.buf.b+=String.fromCharCode(M[U<<2&63])}else if(x==1+C){var R=P.b[x++];this.buf.b+=String.fromCharCode(M[R>>2]),this.buf.b+=String.fromCharCode(M[R<<4&63])}break;default:this.useCache&&this.cache.pop(),null!=e.hxSerialize?(this.buf.b+="C",this.serializeString(te.getClassName(o)),this.useCache&&this.cache.push(e),e.hxSerialize(this),this.buf.b+="g"):(this.buf.b+="c",this.serializeString(te.getClassName(o)),this.useCache&&this.cache.push(e),this.serializeFields(e))}break;case 7:var D=t[2];if(this.useCache){if(this.serializeRef(e))return;this.cache.pop()}this.buf.b+=G.string(this.useEnumIndex?"j":"w"),this.serializeString(te.getEnumName(D)),this.useEnumIndex?(this.buf.b+=":",this.buf.b+=G.string(e[1])):this.serializeString(e[0]),this.buf.b+=":";var V=e.length;this.buf.b+=G.string(V-2);for(var O=2,F=V;O<F;){var j=O++;this.serialize(e[j])}this.useCache&&this.cache.push(e);break;default:throw new se("Cannot serialize "+G.string(e))}},__class__:K};function h(){}(r["haxe._Unserializer.DefaultResolver"]=h).__name__=["haxe","_Unserializer","DefaultResolver"],h.prototype={resolveClass:function(e){return te.resolveClass(e)},resolveEnum:function(e){return te.resolveEnum(e)},__class__:h};var ne=function(e){this.buf=e,this.length=e.length,this.pos=0,this.scache=[],this.cache=[];var t=ne.DEFAULT_RESOLVER;null==t&&(t=new h,ne.DEFAULT_RESOLVER=t),this.resolver=t};(r["haxe.Unserializer"]=ne).__name__=["haxe","Unserializer"],ne.initCodes=function(){for(var e=[],t=0,n=ne.BASE64.length;t<n;){var r=t++;e[ne.BASE64.charCodeAt(r)]=r}return e},ne.prototype={readDigits:function(){for(var e=0,t=!1,n=this.pos;;){var r=this.buf.charCodeAt(this.pos);if(r!=r)break;if(45!=r){if(r<48||57<r)break;e=10*e+(r-48),this.pos++}else{if(this.pos!=n)break;t=!0,this.pos++}}return t&&(e*=-1),e},readFloat:function(){for(var e=this.pos;;){var t=this.buf.charCodeAt(this.pos);if(t!=t)break;if(!(43<=t&&t<58||101==t||69==t))break;this.pos++}return parseFloat(J.substr(this.buf,e,this.pos-e))},unserializeObject:function(e){for(;;){if(this.pos>=this.length)throw new se("Invalid object");if(103==this.buf.charCodeAt(this.pos))break;var t=this.unserialize();if("string"!=typeof t)throw new se("Invalid object key");var n=this.unserialize();e[t]=n}this.pos++},unserializeEnum:function(e,t){if(58!=this.buf.charCodeAt(this.pos++))throw new se("Invalid enum format");var n=this.readDigits();if(0==n)return te.createEnum(e,t);for(var r=[];0<n--;)r.push(this.unserialize());return te.createEnum(e,t,r)},unserialize:function(){switch(this.buf.charCodeAt(this.pos++)){case 65:var e=this.unserialize(),t=this.resolver.resolveClass(e);if(null==t)throw new se("Class not found "+e);return t;case 66:var n=this.unserialize(),r=this.resolver.resolveEnum(n);if(null==r)throw new se("Enum not found "+n);return r;case 67:var i=this.unserialize(),o=this.resolver.resolveClass(i);if(null==o)throw new se("Class not found "+i);var a=te.createEmptyInstance(o);if(this.cache.push(a),a.hxUnserialize(this),103!=this.buf.charCodeAt(this.pos++))throw new se("Invalid custom data");return a;case 77:var s=new ie;this.cache.push(s);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var u=this.unserialize();s.set(u,this.unserialize())}return this.pos++,s;case 82:var l=this.readDigits();if(l<0||l>=this.scache.length)throw new se("Invalid string reference");return this.scache[l];case 97:this.buf;var h=[];for(this.cache.push(h);;){var c=this.buf.charCodeAt(this.pos);if(104==c){this.pos++;break}if(117==c){this.pos++;var f=this.readDigits();h[h.length+f-1]=null}else h.push(this.unserialize())}return h;case 98:var v=new oe;this.cache.push(v);for(this.buf;104!=this.buf.charCodeAt(this.pos);){var _=this.unserialize(),d=this.unserialize();null!=ft[_]?v.setReserved(_,d):v.h[_]=d}return this.pos++,v;case 99:var p=this.unserialize(),m=this.resolver.resolveClass(p);if(null==m)throw new se("Class not found "+p);var g=te.createEmptyInstance(m);return this.cache.push(g),this.unserializeObject(g),g;case 100:return this.readFloat();case 102:return!1;case 105:return this.readDigits();case 106:var b=this.unserialize(),y=this.resolver.resolveEnum(b);if(null==y)throw new se("Enum not found "+b);this.pos++;var w=this.readDigits(),S=y.__constructs__.slice()[w];if(null==S)throw new se("Unknown enum index "+b+"@"+w);var k=this.unserializeEnum(y,S);return this.cache.push(k),k;case 107:return NaN;case 108:var P=new ee;this.cache.push(P);for(this.buf;104!=this.buf.charCodeAt(this.pos);)P.add(this.unserialize());return this.pos++,P;case 109:return-1/0;case 110:return null;case 111:var x={};return this.cache.push(x),this.unserializeObject(x),x;case 112:return 1/0;case 113:var C=new re;this.cache.push(C);this.buf;for(var M=this.buf.charCodeAt(this.pos++);58==M;){var N=this.readDigits(),A=this.unserialize();C.h[N]=A,M=this.buf.charCodeAt(this.pos++)}if(104!=M)throw new se("Invalid IntMap format");return C;case 114:var z=this.readDigits();if(z<0||z>=this.cache.length)throw new se("Invalid reference");return this.cache[z];case 115:var E=this.readDigits(),I=this.buf;if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<E)throw new se("Invalid bytes length");var L=ne.CODES;null==L&&(L=ne.initCodes(),ne.CODES=L);for(var T=this.pos,B=3&E,U=T+(E-B),R=new ae(new vt(3*(E>>2)+(2<=B?B-1:0))),D=0;T<U;){var V=L[I.charCodeAt(T++)],O=L[I.charCodeAt(T++)];R.b[D++]=255&(V<<2|O>>4);var F=L[I.charCodeAt(T++)];R.b[D++]=255&(O<<4|F>>2);var j=L[I.charCodeAt(T++)];R.b[D++]=255&(F<<6|j)}if(2<=B){var q=L[I.charCodeAt(T++)],G=L[I.charCodeAt(T++)];if(R.b[D++]=255&(q<<2|G>>4),3==B){var K=L[I.charCodeAt(T++)];R.b[D++]=255&(G<<4|K>>2)}}return this.pos+=E,this.cache.push(R),R;case 116:return!0;case 118:var W;if(48<=this.buf.charCodeAt(this.pos)&&this.buf.charCodeAt(this.pos)<=57&&48<=this.buf.charCodeAt(this.pos+1)&&this.buf.charCodeAt(this.pos+1)<=57&&48<=this.buf.charCodeAt(this.pos+2)&&this.buf.charCodeAt(this.pos+2)<=57&&48<=this.buf.charCodeAt(this.pos+3)&&this.buf.charCodeAt(this.pos+3)<=57&&45==this.buf.charCodeAt(this.pos+4))W=J.strDate(J.substr(this.buf,this.pos,19)),this.pos+=19;else{var H=this.readFloat();W=new Date(H)}return this.cache.push(W),W;case 119:var Q=this.unserialize(),Y=this.resolver.resolveEnum(Q);if(null==Y)throw new se("Enum not found "+Q);var Z=this.unserializeEnum(Y,this.unserialize());return this.cache.push(Z),Z;case 120:throw se.wrap(this.unserialize());case 121:var X=this.readDigits();if(58!=this.buf.charCodeAt(this.pos++)||this.length-this.pos<X)throw new se("Invalid string length");var $=J.substr(this.buf,this.pos,X);return this.pos+=X,$=decodeURIComponent($.split("+").join(" ")),this.scache.push($),$;case 122:return 0}throw this.pos--,new se("Invalid char "+this.buf.charAt(this.pos)+" at position "+this.pos)},__class__:ne};var re=function(){this.h={}};(r["haxe.ds.IntMap"]=re).__name__=["haxe","ds","IntMap"],re.__interfaces__=[l],re.prototype={remove:function(e){return!!this.h.hasOwnProperty(e)&&(delete this.h[e],!0)},keys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(0|t);return J.iter(e)},__class__:re};var ie=function(){this.h={__keys__:{}}};(r["haxe.ds.ObjectMap"]=ie).__name__=["haxe","ds","ObjectMap"],ie.__interfaces__=[l],ie.assignId=function(e){return e.__id__=++ie.count},ie.getId=function(e){return e.__id__},ie.prototype={set:function(e,t){var n=e.__id__||(e.__id__=++ie.count);this.h[n]=t,this.h.__keys__[n]=e},keys:function(){var e=[];for(var t in this.h.__keys__)this.h.hasOwnProperty(t)&&e.push(this.h.__keys__[t]);return J.iter(e)},__class__:ie};var c=r["haxe.ds.Option"]={__ename__:["haxe","ds","Option"],__constructs__:["Some","None"]};c.Some=function(e){var t=["Some",0,e];return t.__enum__=c,t.toString=n,t},c.None=["None",1],c.None.toString=n,c.None.__enum__=c;var oe=function(){this.h={}};(r["haxe.ds.StringMap"]=oe).__name__=["haxe","ds","StringMap"],oe.__interfaces__=[l],oe.prototype={setReserved:function(e,t){null==this.rh&&(this.rh={}),this.rh["$"+e]=t},getReserved:function(e){return null==this.rh?null:this.rh["$"+e]},keys:function(){return J.iter(this.arrayKeys())},arrayKeys:function(){var e=[];for(var t in this.h)this.h.hasOwnProperty(t)&&e.push(t);if(null!=this.rh)for(var t in this.rh)36==t.charCodeAt(0)&&e.push(t.substr(1));return e},__class__:oe};var ae=function(e){this.length=e.byteLength,this.b=new _t(e),(this.b.bufferValue=e).hxBytes=this,e.bytes=this.b};(r["haxe.io.Bytes"]=ae).__name__=["haxe","io","Bytes"],ae.alloc=function(e){return new ae(new vt(e))},ae.ofString=function(e){for(var t=[],n=0;n<e.length;){var r=e.charCodeAt(n++);55296<=r&&r<=56319&&(r=r-55232<<10|1023&e.charCodeAt(n++)),r<=127?t.push(r):(r<=2047?t.push(192|r>>6):(r<=65535?t.push(224|r>>12):(t.push(240|r>>18),t.push(128|r>>12&63)),t.push(128|r>>6&63)),t.push(128|63&r))}return new ae(new _t(t).buffer)},ae.ofData=function(e){var t=e.hxBytes;return null!=t?t:new ae(e)},ae.fastGet=function(e,t){return e.bytes[t]},ae.prototype={__class__:ae};var se=function(e){Error.call(this),this.val=e,this.message=String(e),Error.captureStackTrace&&Error.captureStackTrace(this,se)};(r["js._Boot.HaxeError"]=se).__name__=["js","_Boot","HaxeError"],se.wrap=function(e){return e instanceof Error?e:new se(e)},se.__super__=Error,se.prototype=i(Error.prototype,{__class__:se});var W=function(){};(r["js.Boot"]=W).__name__=["js","Boot"],W.getClass=function(e){if(e instanceof Array&&null==e.__enum__)return Array;var t=e.__class__;if(null!=t)return t;var n=W.__nativeClassName(e);return null!=n?W.__resolveNativeClass(n):null},W.__string_rec=function(e,t){if(null==e)return"null";if(5<=t.length)return"<...>";var n=typeof e;switch("function"==n&&(e.__name__||e.__ename__)&&(n="object"),n){case"function":return"<function>";case"object":if(e instanceof Array){if(e.__enum__){if(2==e.length)return e[0];var r=e[0]+"(";t+="\t";for(var i=2,o=e.length;i<o;){var a=i++;r+=2!=a?","+W.__string_rec(e[a],t):W.__string_rec(e[a],t)}return r+")"}var s="[";t+="\t";for(var u=0,l=e.length;u<l;){var h=u++;s+=(0<h?",":"")+W.__string_rec(e[h],t)}return s+="]"}var c;try{c=e.toString}catch(e){return"???"}if(null!=c&&c!=Object.toString&&"function"==typeof c){var f=e.toString();if("[object Object]"!=f)return f}var v=null,_="{\n";t+="\t";var d=null!=e.hasOwnProperty;for(var v in e)d&&!e.hasOwnProperty(v)||"prototype"!=v&&"__class__"!=v&&"__super__"!=v&&"__interfaces__"!=v&&"__properties__"!=v&&(2!=_.length&&(_+=", \n"),_+=t+v+" : "+W.__string_rec(e[v],t));return _+="\n"+(t=t.substring(1))+"}";case"string":return e;default:return String(e)}},W.__interfLoop=function(e,t){if(null==e)return!1;if(e==t)return!0;var n=e.__interfaces__;if(null!=n)for(var r=0,i=n.length;r<i;){var o=n[r++];if(o==t||W.__interfLoop(o,t))return!0}return W.__interfLoop(e.__super__,t)},W.__instanceof=function(e,t){if(null==t)return!1;switch(t){case Array:return e instanceof Array&&null==e.__enum__;case lt:return"boolean"==typeof e;case st:return!0;case ut:return"number"==typeof e;case at:return"number"==typeof e&&(0|e)===e;case String:return"string"==typeof e;default:if(null==e)return!1;if("function"==typeof t){if(e instanceof t)return!0;if(W.__interfLoop(W.getClass(e),t))return!0}else if("object"==typeof t&&W.__isNativeObj(t)&&e instanceof t)return!0;return t==ht&&null!=e.__name__||(t==ct&&null!=e.__ename__||e.__enum__==t)}},W.__nativeClassName=function(e){var t=W.__toStr.call(e).slice(8,-1);return"Object"==t||"Function"==t||"Math"==t||"JSON"==t?null:t},W.__isNativeObj=function(e){return null!=W.__nativeClassName(e)},W.__resolveNativeClass=function(e){return t[e]};function f(e){if(e instanceof Array&&null==e.__enum__)this.a=e,this.byteLength=e.length;else{var t=e;this.a=[];for(var n=0,r=t;n<r;){var i=n++;this.a[i]=0}this.byteLength=t}}(r["js.html.compat.ArrayBuffer"]=f).__name__=["js","html","compat","ArrayBuffer"],f.sliceImpl=function(e,t){var n=new _t(this,e,null==t?null:t-e),r=new vt(n.byteLength);return new _t(r).set(n),r},f.prototype={slice:function(e,t){return new f(this.a.slice(e,t))},__class__:f};function v(){}(r["js.html.compat.Uint8Array"]=v).__name__=["js","html","compat","Uint8Array"],v._new=function(e,t,n){var r;if("number"==typeof e){r=[];for(var i=0,o=e;i<o;){r[i++]=0}r.byteLength=r.length,r.byteOffset=0,r.buffer=new f(r)}else if(W.__instanceof(e,f)){var a=e;null==t&&(t=0),null==n&&(n=a.byteLength-t),(r=0==t?a.a:a.a.slice(t,t+n)).byteLength=r.length,r.byteOffset=t,r.buffer=a}else{if(!(e instanceof Array&&null==e.__enum__))throw new se("TODO "+G.string(e));(r=e.slice()).byteLength=r.length,r.byteOffset=0,r.buffer=new f(r)}return r.subarray=v._subarray,r.set=v._set,r},v._set=function(e,t){if(W.__instanceof(e.buffer,f)){var n=e;if(e.byteLength+t>this.byteLength)throw new se("set() outside of range");for(var r=0,i=e.byteLength;r<i;){var o=r++;this[o+t]=n[o]}}else{if(!(e instanceof Array&&null==e.__enum__))throw new se("TODO");var a=e;if(a.length+t>this.byteLength)throw new se("set() outside of range");for(var s=0,u=a.length;s<u;){var l=s++;this[l+t]=a[l]}}},v._subarray=function(e,t){var n=v._new(this.slice(e,t));return n.byteOffset=e,n};var p=function(e){if(this._resolved=!1,this._pending=!1,this._errorPending=!1,this._fulfilled=!1,this._update=[],this._error=[],this._errored=!1,null!=e){var n=this,r=function(e){return e};e._update.push({async:n,linkf:function(e){var t=r(e);n.handleResolve(t)}}),p.immediateLinkUpdate(e,n,r)}};(r["promhx.base.AsyncBase"]=p).__name__=["promhx","base","AsyncBase"],p.link=function(e,n,r){e._update.push({async:n,linkf:function(e){var t=r(e);n.handleResolve(t)}}),p.immediateLinkUpdate(e,n,r)},p.immediateLinkUpdate=function(e,t,n){if(e._errored&&!e._errorPending&&e._error.length<=0&&t.handleError(e._errorVal),e._resolved&&!e._pending)try{t.handleResolve(n(e._val))}catch(e){e instanceof se&&(e=e.val),t.handleError(e)}},p.linkAll=function(s,u){for(var e=function(e,t,n){if(0==e.length||p.allFulfilled(e)){for(var r=[],i=nt(s)();i.hasNext();){var o=i.next();r.push(o==t?n:o._val)}var a=r;u.handleResolve(a)}},t=nt(s)();t.hasNext();){for(var n=t.next(),r=n._update,i=[e],o=[],a=nt(s)();a.hasNext();){var l=a.next();l!=n&&o.push(l)}var h=function(t,n,r){return function(e){r[0](n[0],t[0],e)}}([n],[o],i);r.push({async:u,linkf:h})}if(p.allFulfilled(s)){for(var c=[],f=nt(s)();f.hasNext();){var v=f.next();c.push(v._val)}u.handleResolve(c)}},p.pipeLink=function(e,n,r){function t(e){if(!i){i=!0;var t=r(e);t._update.push({async:n,linkf:ot(n,n.handleResolve)}),p.immediateLinkUpdate(t,n,function(e){return e})}}var i=!1;if(e._update.push({async:n,linkf:t}),e._resolved&&!e._pending)try{t(e._val)}catch(e){e instanceof se&&(e=e.val),n.handleError(e)}},p.allResolved=function(e){for(var t=nt(e)();t.hasNext();){if(!t.next()._resolved)return!1}return!0},p.allFulfilled=function(e){for(var t=nt(e)();t.hasNext();){if(!t.next()._fulfilled)return!1}return!0},p.prototype={catchError:function(e){return this._error.push(e),this},errorThen:function(e){return this._errorMap=e,this},isResolved:function(){return this._resolved},isErrored:function(){return this._errored},isErrorHandled:function(){return 0<this._error.length},isErrorPending:function(){return this._errorPending},isFulfilled:function(){return this._fulfilled},isPending:function(){return this._pending},handleResolve:function(e){this._resolve(e)},_resolve:function(r){var i=this;if(this._pending){var e=ot(this,this._resolve),t=r;b.queue.add(function(){e(t)}),b.continueOnNextLoop()}else this._resolved=!0,this._pending=!0,b.queue.add(function(){i._val=r;for(var e=0,t=i._update;e<t.length;){var n=t[e];++e;try{n.linkf(r)}catch(e){e instanceof se&&(e=e.val),n.async.handleError(e)}}i._fulfilled=!0,i._pending=!1}),b.continueOnNextLoop()},handleError:function(e){this._handleError(e)},_handleError:function(t){function n(e){if(0<s._error.length)for(var t=0,n=s._error;t<n.length;){var r=n[t];++t,r(e)}else{if(!(0<s._update.length))throw se.wrap(e);for(var i=0,o=s._update;i<o.length;){var a=o[i];++i,a.async.handleError(e)}}s._errorPending=!1}var s=this;this._errorPending||(this._errorPending=!0,this._errored=!0,this._errorVal=t,b.queue.add(function(){if(null!=s._errorMap)try{var e=s._errorMap(t);s._resolve(e)}catch(e){e instanceof se&&(e=e.val),n(e)}else n(t)}),b.continueOnNextLoop())},then:function(e){var t=new p(null),n=t,r=e;return this._update.push({async:n,linkf:function(e){var t=r(e);n.handleResolve(t)}}),p.immediateLinkUpdate(this,n,r),t},unlink:function(t){var e=this;b.queue.add(function(){e._update=e._update.filter(function(e){return e.async!=t})}),b.continueOnNextLoop()},isLinked:function(e){for(var t=0,n=this._update;t<n.length;){var r=n[t];if(++t,r.async==e)return!0}return!1},__class__:p};var _=e.promhx.Deferred=function(){p.call(this)};(r["promhx.Deferred"]=_).__name__=["promhx","Deferred"],_.__super__=p,_.prototype=i(p.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},promise:function(){return new m(this)},stream:function(){return new g(this)},publicStream:function(){return new d(this)},__class__:_});var m=e.promhx.Promise=function(e){p.call(this,e),this._rejected=!1};(r["promhx.Promise"]=m).__name__=["promhx","Promise"],m.whenAll=function(e){for(var t=new m(null),s=e,u=t,n=function(e,t,n){if(0==e.length||p.allFulfilled(e)){for(var r=[],i=nt(s)();i.hasNext();){var o=i.next();r.push(o==t?n:o._val)}var a=r;u.handleResolve(a)}},r=nt(s)();r.hasNext();){for(var i=r.next(),o=i._update,a=[n],l=[],h=nt(s)();h.hasNext();){var c=h.next();c!=i&&l.push(c)}var f=function(t,n,r){return function(e){r[0](n[0],t[0],e)}}([i],[l],a);o.push({async:u,linkf:f})}if(p.allFulfilled(s)){for(var v=[],_=nt(s)();_.hasNext();){var d=_.next();v.push(d._val)}u.handleResolve(v)}return t},m.promise=function(e){var t=new m;return t.handleResolve(e),t},m.__super__=p,m.prototype=i(p.prototype,{isRejected:function(){return this._rejected},reject:function(e){this._rejected=!0,this.handleError(e)},handleResolve:function(e){if(this._resolved){throw new se(y.AlreadyResolved("Promise has already been resolved"))}this._resolve(e)},then:function(e){var t=new m(null),n=t,r=e;return this._update.push({async:n,linkf:function(e){var t=r(e);n.handleResolve(t)}}),p.immediateLinkUpdate(this,n,r),t},unlink:function(t){var e=this;b.queue.add(function(){if(e._fulfilled)e._update=e._update.filter(function(e){return e.async!=t});else{e.handleError(y.DownstreamNotFullfilled("Downstream Promise is not fullfilled"))}}),b.continueOnNextLoop()},handleError:function(e){this._rejected=!0,this._handleError(e)},pipe:function(e){function t(e){if(!o){o=!0;var t=i(e);t._update.push({async:r,linkf:ot(r,r.handleResolve)}),p.immediateLinkUpdate(t,r,function(e){return e})}}var n=new m(null),r=n,i=e,o=!1;if(this._update.push({async:r,linkf:t}),this._resolved&&!this._pending)try{t(this._val)}catch(e){e instanceof se&&(e=e.val),r.handleError(e)}return n},errorPipe:function(t){var n=new m;return this.catchError(function(e){t(e).then(ot(n,n._resolve))}),this.then(ot(n,n._resolve)),n},__class__:m});var g=e.promhx.Stream=function(e){p.call(this,e),this._end_promise=new m};(r["promhx.Stream"]=g).__name__=["promhx","Stream"],g.foreach=function(e){for(var t=new g(null),n=nt(e)();n.hasNext();){var r=n.next();t.handleResolve(r)}return t.end(),t},g.wheneverAll=function(e){for(var t=new g(null),s=e,u=t,n=function(e,t,n){if(0==e.length||p.allFulfilled(e)){for(var r=[],i=nt(s)();i.hasNext();){var o=i.next();r.push(o==t?n:o._val)}var a=r;u.handleResolve(a)}},r=nt(s)();r.hasNext();){for(var i=r.next(),o=i._update,a=[n],l=[],h=nt(s)();h.hasNext();){var c=h.next();c!=i&&l.push(c)}var f=function(t,n,r){return function(e){r[0](n[0],t[0],e)}}([i],[l],a);o.push({async:u,linkf:f})}if(p.allFulfilled(s)){for(var v=[],_=nt(s)();_.hasNext();){var d=_.next();v.push(d._val)}u.handleResolve(v)}return t},g.concatAll=function(e){for(var t=new g(null),n=nt(e)();n.hasNext();){var r=n.next();t.concat(r)}return t},g.mergeAll=function(e){for(var t=new g(null),n=nt(e)();n.hasNext();){var r=n.next();t.merge(r)}return t},g.stream=function(e){var t=new g(null);return t.handleResolve(e),t},g.__super__=p,g.prototype=i(p.prototype,{then:function(e){var t=new g(null),n=t,r=e;return this._update.push({async:n,linkf:function(e){var t=r(e);n.handleResolve(t)}}),p.immediateLinkUpdate(this,n,r),this._end_promise._update.push({async:t._end_promise,linkf:function(e){t.end()}}),t},detachStream:function(t){for(var e=[],n=!1,r=0,i=this._update;r<i.length;){var o=i[r];++r,o.async==t?(this._end_promise._update=this._end_promise._update.filter(function(e){return e.async!=t._end_promise}),n=!0):e.push(o)}return this._update=e,n},first:function(){var t=new m(null);return this.then(function(e){t._resolved||t.handleResolve(e)}),t},handleResolve:function(e){this._end||this._pause||this._resolve(e)},pause:function(e){null==e&&(e=!this._pause),this._pause=e},pipe:function(e){function t(e){if(!o){o=!0;var t=i(e);t._update.push({async:r,linkf:ot(r,r.handleResolve)}),p.immediateLinkUpdate(t,r,function(e){return e})}}var n=new g(null),r=n,i=e,o=!1;if(this._update.push({async:r,linkf:t}),this._resolved&&!this._pending)try{t(this._val)}catch(e){e instanceof se&&(e=e.val),r.handleError(e)}return this._end_promise.then(function(e){n.end()}),n},errorPipe:function(n){var r=new g(null);return this.catchError(function(e){var t=n(e);t.then(ot(r,r._resolve)),t._end_promise.then(ot(rt=r._end_promise,rt._resolve))}),this.then(ot(r,r._resolve)),this._end_promise.then(function(e){r.end()}),r},handleEnd:function(){if(this._pending)b.queue.add(ot(this,this.handleEnd)),b.continueOnNextLoop();else{if(this._end_promise._resolved)return;this._end=!0;var e=this._resolved?c.Some(this._val):c.None;this._end_promise.handleResolve(e),this._update=[],this._error=[]}},end:function(){return b.queue.add(ot(this,this.handleEnd)),b.continueOnNextLoop(),this},endThen:function(e){return this._end_promise.then(e)},filter:function(t){var n=new g(null);return this._update.push({async:n,linkf:function(e){t(e)&&n.handleResolve(e)}}),p.immediateLinkUpdate(this,n,function(e){return e}),n},concat:function(t){var n=new g(null);return this._update.push({async:n,linkf:ot(n,n.handleResolve)}),p.immediateLinkUpdate(this,n,function(e){return e}),this._end_promise.then(function(e){t.pipe(function(e){return n.handleResolve(e),n}),t._end_promise.then(function(e){n.end()})}),n},merge:function(e){var t=new g(null);return this._update.push({async:t,linkf:ot(t,t.handleResolve)}),e._update.push({async:t,linkf:ot(t,t.handleResolve)}),p.immediateLinkUpdate(this,t,function(e){return e}),p.immediateLinkUpdate(e,t,function(e){return e}),t},__class__:g});var d=e.promhx.PublicStream=function(e){g.call(this,e)};(r["promhx.PublicStream"]=d).__name__=["promhx","PublicStream"],d.publicstream=function(e){var t=new d(null);return t.handleResolve(e),t},d.__super__=g,d.prototype=i(g.prototype,{resolve:function(e){this.handleResolve(e)},throwError:function(e){this.handleError(e)},update:function(e){this.handleResolve(e)},__class__:d});var b=function(){};(r["promhx.base.EventLoop"]=b).__name__=["promhx","base","EventLoop"],b.enqueue=function(e){b.queue.add(e),b.continueOnNextLoop()},b.set_nextLoop=function(e){if(null!=b.nextLoop)throw new se("nextLoop has already been set");return b.nextLoop=e,b.nextLoop},b.queueEmpty=function(){return b.queue.isEmpty()},b.finish=function(e){null==e&&(e=1e3);for(var t=null;;){if(!(0<e--&&null!=(t=b.queue.pop())))break;t()}return b.queue.isEmpty()},b.clear=function(){b.queue=new ee},b.f=function(){var e=b.queue.pop();null!=e&&e(),b.queue.isEmpty()||b.continueOnNextLoop()},b.continueOnNextLoop=function(){null!=b.nextLoop?b.nextLoop(b.f):setImmediate(b.f)};var y=r["promhx.error.PromiseError"]={__ename__:["promhx","error","PromiseError"],__constructs__:["AlreadyResolved","DownstreamNotFullfilled"]};y.AlreadyResolved=function(e){var t=["AlreadyResolved",0,e];return t.__enum__=y,t.toString=n,t},y.DownstreamNotFullfilled=function(e){var t=["DownstreamNotFullfilled",1,e];return t.__enum__=y,t.toString=n,t};function w(){}(r["verb.Verb"]=w).__name__=["verb","Verb"],w.main=function(){console.log("verb 2.1.0")};function Z(){}(r["verb.core.ArrayExtensions"]=Z).__name__=["verb","core","ArrayExtensions"],Z.alloc=function(e,t){if(!(t<0))for(;e.length<t;)e.push(null)},Z.reversed=function(e){var t=e.slice();return t.reverse(),t},Z.last=function(e){return e[e.length-1]},Z.first=function(e){return e[0]},Z.spliceAndInsert=function(e,t,n,r){e.splice(t,n),e.splice(t,0,r)},Z.left=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(0,t)},Z.right=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(t)},Z.rightWithPivot=function(e){if(0==e.length)return[];var t=Math.ceil(e.length/2);return e.slice(t-1)},Z.unique=function(e,t){if(0==e.length)return[];for(var n=[e.pop()];0<e.length;){for(var r=e.pop(),i=!0,o=0;o<n.length;){var a=n[o];if(++o,t(r,a)){i=!1;break}}i&&n.push(r)}return n};function Re(){}(r["verb.core.Binomial"]=Re).__name__=["verb","core","Binomial"],Re.get=function(e,t){if(0==t)return 1;if(0==e||e<t)return 0;if(e-t<t&&(t=e-t),Re.memo_exists(e,t))return Re.get_memo(e,t);for(var n=1,r=e,i=1,o=t+1;i<o;){var a=i++;Re.memo_exists(r,a)?(--e,n=Re.get_memo(r,a)):(n*=e--,Re.memoize(r,a,n/=a))}return n},Re.get_no_memo=function(e,t){if(0==t)return 1;if(0==e||e<t)return 0;e-t<t&&(t=e-t);for(var n=1,r=1,i=t+1;r<i;){n*=e--,n/=r++}return n},Re.memo_exists=function(e,t){return!!Re.memo.h.hasOwnProperty(e)&&Re.memo.h[e].h.hasOwnProperty(t)},Re.get_memo=function(e,t){return Re.memo.h[e].h[t]},Re.memoize=function(e,t,n){if(!Re.memo.h.hasOwnProperty(e)){var r=Re.memo,i=new re;r.h[e]=i}Re.memo.h[e].h[t]=n};var S=e.core.BoundingBox=function(e){this.max=null,this.min=null,this.dim=3,this.initialized=!1,null!=e&&this.addRange(e)};(r["verb.core.BoundingBox"]=S).__name__=["verb","core","BoundingBox"],S.intervalsOverlap=function(e,t,n,r,i){null==i&&(i=-1);var o=i<-.5?D.TOLERANCE:i,a=Math.min(e,t)-o,s=Math.max(e,t)+o,u=Math.min(n,r)-o,l=Math.max(n,r)+o;return u<=a&&a<=l||u<=s&&s<=l||a<=u&&u<=s||a<=l&&l<=s},S.prototype={fromPoint:function(e){return new S([e])},add:function(e){if(!this.initialized)return this.dim=e.length,this.min=e.slice(0),this.max=e.slice(0),this.initialized=!0,this;for(var t=0,n=this.dim;t<n;){var r=t++;e[r]>this.max[r]&&(this.max[r]=e[r]),e[r]<this.min[r]&&(this.min[r]=e[r])}return this},addRange:function(e){for(var t=0,n=e.length;t<n;){var r=t++;this.add(e[r])}return this},contains:function(e,t){return null==t&&(t=-1),!!this.initialized&&this.intersects(new S([e]),t)},intersects:function(e,t){if(null==t&&(t=-1),!this.initialized||!e.initialized)return!1;for(var n=this.min,r=this.max,i=e.min,o=e.max,a=0,s=this.dim;a<s;){var u=a++;if(!S.intervalsOverlap(n[u],r[u],i[u],o[u],t))return!1}return!0},clear:function(){return this.initialized=!1,this},getLongestAxis:function(){for(var e=0,t=0,n=0,r=this.dim;n<r;){var i=n++,o=this.getAxisLength(i);e<o&&(e=o,t=i)}return t},getAxisLength:function(e){return e<0||e>this.dim-1?0:Math.abs(this.min[e]-this.max[e])},intersect:function(e,t){if(!this.initialized)return null;var n=this.min,r=this.max,i=e.min,o=e.max;if(!this.intersects(e,t))return null;for(var a=[],s=[],u=0,l=this.dim;u<l;){var h=u++;a.push(Math.min(r[h],o[h])),s.push(Math.max(n[h],i[h]))}return new S([s,a])},__class__:S};var D=e.core.Constants=function(){};(r["verb.core.Constants"]=D).__name__=["verb","core","Constants"];var k=e.core.SerializableBase=function(){};(r["verb.core.SerializableBase"]=k).__name__=["verb","core","SerializableBase"],k.prototype={serialize:function(){var e=new K;return e.serialize(this),e.toString()},__class__:k};var P=e.core.Plane=function(e,t){this.origin=e,this.normal=t};(r["verb.core.Plane"]=P).__name__=["verb","core","Plane"],P.__super__=k,P.prototype=i(k.prototype,{__class__:P});var x=e.core.Ray=function(e,t){this.origin=e,this.dir=t};(r["verb.core.Ray"]=x).__name__=["verb","core","Ray"],x.__super__=k,x.prototype=i(k.prototype,{__class__:x});var De=e.core.NurbsCurveData=function(e,t,n){this.degree=e,this.controlPoints=n,this.knots=t};(r["verb.core.NurbsCurveData"]=De).__name__=["verb","core","NurbsCurveData"],De.__super__=k,De.prototype=i(k.prototype,{__class__:De});var V=e.core.NurbsSurfaceData=function(e,t,n,r,i){this.degreeU=e,this.degreeV=t,this.knotsU=n,this.knotsV=r,this.controlPoints=i};(r["verb.core.NurbsSurfaceData"]=V).__name__=["verb","core","NurbsSurfaceData"],V.__super__=k,V.prototype=i(k.prototype,{__class__:V});var I=e.core.MeshData=function(e,t,n,r){this.faces=e,this.points=t,this.normals=n,this.uvs=r};(r["verb.core.MeshData"]=I).__name__=["verb","core","MeshData"],I.empty=function(){return new I([],[],[],[])},I.__super__=k,I.prototype=i(k.prototype,{__class__:I});var C=e.core.PolylineData=function(e,t){this.points=e,this.params=t};(r["verb.core.PolylineData"]=C).__name__=["verb","core","PolylineData"],C.__super__=k,C.prototype=i(k.prototype,{__class__:C});var M=e.core.VolumeData=function(e,t,n,r,i,o,a){this.degreeU=e,this.degreeV=t,this.degreeW=n,this.knotsU=r,this.knotsV=i,this.knotsW=o,this.controlPoints=a};(r["verb.core.VolumeData"]=M).__name__=["verb","core","VolumeData"],M.__super__=k,M.prototype=i(k.prototype,{__class__:M});var A=e.core.Pair=function(e,t){this.item0=e,this.item1=t};(r["verb.core.Pair"]=A).__name__=["verb","core","Pair"],A.prototype={__class__:A};var z=e.core.Interval=function(e,t){this.min=e,this.max=t};(r["verb.core.Interval"]=z).__name__=["verb","core","Interval"],z.prototype={__class__:z};var E=e.core.CurveCurveIntersection=function(e,t,n,r){this.point0=e,this.point1=t,this.u0=n,this.u1=r};(r["verb.core.CurveCurveIntersection"]=E).__name__=["verb","core","CurveCurveIntersection"],E.prototype={__class__:E};var L=e.core.CurveSurfaceIntersection=function(e,t,n,r){this.u=e,this.uv=t,this.curvePoint=n,this.surfacePoint=r};(r["verb.core.CurveSurfaceIntersection"]=L).__name__=["verb","core","CurveSurfaceIntersection"],L.prototype={__class__:L};var T=e.core.MeshIntersectionPoint=function(e,t,n,r,i){this.visited=!1,this.adj=null,this.opp=null,this.uv0=e,this.uv1=t,this.point=n};(r["verb.core.MeshIntersectionPoint"]=T).__name__=["verb","core","MeshIntersectionPoint"],T.prototype={__class__:T};var B=e.core.PolylineMeshIntersection=function(e,t,n,r,i){this.point=e,this.u=t,this.uv=n,this.polylineIndex=r,this.faceIndex=i};(r["verb.core.PolylineMeshIntersection"]=B).__name__=["verb","core","PolylineMeshIntersection"],B.prototype={__class__:B};var U=e.core.SurfaceSurfaceIntersectionPoint=function(e,t,n,r){this.uv0=e,this.uv1=t,this.point=n,this.dist=r};(r["verb.core.SurfaceSurfaceIntersectionPoint"]=U).__name__=["verb","core","SurfaceSurfaceIntersectionPoint"],U.prototype={__class__:U};var R=e.core.TriSegmentIntersection=function(e,t,n,r){this.point=e,this.s=t,this.t=n,this.p=r};(r["verb.core.TriSegmentIntersection"]=R).__name__=["verb","core","TriSegmentIntersection"],R.prototype={__class__:R};var O=e.core.CurveTriPoint=function(e,t,n){this.u=e,this.point=t,this.uv=n};(r["verb.core.CurveTriPoint"]=O).__name__=["verb","core","CurveTriPoint"],O.prototype={__class__:O};function j(e,t,n,r,i){null==i&&(i=!1),null==r&&(r=-1),this.uv=n,this.point=e,this.normal=t,this.id=r,this.degen=i}(r["verb.core.SurfacePoint"]=j).__name__=["verb","core","SurfacePoint"],j.fromUv=function(e,t){return new j(null,null,[e,t])},j.prototype={__class__:j};var F=e.core.CurvePoint=function(e,t){this.u=e,this.pt=t};(r["verb.core.CurvePoint"]=F).__name__=["verb","core","CurvePoint"],F.prototype={__class__:F};var H=e.core.KdTree=function(e,t){this.dim=3,this.points=e,this.distanceFunction=t,this.dim=e[0].point.length,this.root=this.buildTree(e,0,null)};(r["verb.core.KdTree"]=H).__name__=["verb","core","KdTree"],H.prototype={buildTree:function(e,t,n){var r,i,o=t%this.dim;return 0==e.length?null:1==e.length?new X(e[0],o,n):(e.sort(function(e,t){var n=e.point[o]-t.point[o];return 0==n?0:0<n?1:-1}),r=Math.floor(e.length/2),(i=new X(e[r],o,n)).left=this.buildTree(e.slice(0,r),t+1,i),i.right=this.buildTree(e.slice(r+1),t+1,i),i)},nearest:function(_,d,e){for(var p=this,m=new Q(function(e){return-e.item1}),g=null,t=g=function(e){for(var t,n=e.dimension,r=p.distanceFunction(_,e.kdPoint.point),i=[],o=0,a=p.dim;o<a;){o++;i.push(0)}for(var s,u,l=i,h=function(e,t){m.push(new A(e,t)),m.size()>d&&m.pop()},c=0,f=p.dim;c<f;){var v=c++;v==e.dimension?l[v]=_[v]:l[v]=e.kdPoint.point[v]}s=p.distanceFunction(l,e.kdPoint.point),null!=e.right||null!=e.left?(t=null==e.right?e.left:null==e.left?e.right:_[n]<e.kdPoint.point[n]?e.left:e.right,g(t),(m.size()<d||r<m.peek().item1)&&h(e,r),(m.size()<d||Math.abs(s)<m.peek().item1)&&null!=(u=t==e.left?e.right:e.left)&&g(u)):(m.size()<d||r<m.peek().item1)&&h(e,r)},n=0,r=d;n<r;){n++;m.push(new A(null,e))}t(this.root);for(var i=[],o=0,a=d;o<a;){var s=o++;null!=m.content[s].item0&&i.push(new A(m.content[s].item0.kdPoint,m.content[s].item1))}return i},__class__:H};var Q=function(e){this.content=[],this.scoreFunction=e};(r["verb.core.BinaryHeap"]=Q).__name__=["verb","core","BinaryHeap"],Q.prototype={push:function(e){this.content.push(e),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return 0<this.content.length&&(this.content[0]=t,this.sinkDown(0)),e},peek:function(){return this.content[0]},remove:function(e){for(var t=this.content.length,n=0,r=t;n<r;){var i=n++;if(this.content[i]==e){var o=this.content.pop();return void(i!=t-1&&(this.content[i]=o,this.scoreFunction(o)<this.scoreFunction(e)?this.bubbleUp(i):this.sinkDown(i)))}}throw new se("Node not found.")},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];0<e;){var n=Math.floor((e+1)/2)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},sinkDown:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var i=2*(e+1),o=i-1,a=-1,s=0;if(o<t){var u=this.content[o];(s=this.scoreFunction(u))<r&&(a=o)}if(i<t){var l=this.content[i];this.scoreFunction(l)<(-1==a?r:s)&&(a=i)}if(-1==a)break;this.content[e]=this.content[a],this.content[a]=n,e=a}},__class__:Q};var Y=e.core.KdPoint=function(e,t){this.point=e,this.obj=t};(r["verb.core.KdPoint"]=Y).__name__=["verb","core","KdPoint"],Y.prototype={__class__:Y};var X=e.core.KdNode=function(e,t,n){this.kdPoint=e,this.left=null,this.right=null,this.parent=n,this.dimension=t};(r["verb.core.KdNode"]=X).__name__=["verb","core","KdNode"],X.prototype={__class__:X};function $(){}(r["verb.eval.IBoundingBoxTree"]=$).__name__=["verb","eval","IBoundingBoxTree"],$.prototype={__class__:$};function ue(e,t){if(this._boundingBox=null,this._curve=e,null==t){var n=this._curve.knots;t=(Z.last(n)-Z.first(n))/64}this._knotTol=t}(r["verb.core.LazyCurveBoundingBoxTree"]=ue).__name__=["verb","core","LazyCurveBoundingBoxTree"],ue.__interfaces__=[$],ue.prototype={split:function(){var e=Z.first(this._curve.knots),t=Z.last(this._curve.knots),n=t-e,r=Pe.curveSplit(this._curve,(t+e)/2+.1*n*Math.random());return new A(new ue(r[0],this._knotTol),new ue(r[1],this._knotTol))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new S(Ce.dehomogenize1d(this._curve.controlPoints))),this._boundingBox},yield:function(){return this._curve},indivisible:function(e){var t=this._curve.knots;return Z.last(t)-Z.first(t)<this._knotTol},empty:function(){return!1},__class__:ue};function le(e,t){if(this._boundingBox=null,this._mesh=e,null==t){for(var n=[],r=0,i=e.faces.length;r<i;){var o=r++;n.push(o)}t=n}this._faceIndices=t}(r["verb.core.LazyMeshBoundingBoxTree"]=le).__name__=["verb","core","LazyMeshBoundingBoxTree"],le.__interfaces__=[$],le.prototype={split:function(){var e=_e.sortTrianglesOnLongestAxis(this.boundingBox(),this._mesh,this._faceIndices),t=Z.left(e),n=Z.right(e);return new A(new le(this._mesh,t),new le(this._mesh,n))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=_e.makeMeshAabb(this._mesh,this._faceIndices)),this._boundingBox},yield:function(){return this._faceIndices[0]},indivisible:function(e){return 1==this._faceIndices.length},empty:function(){return 0==this._faceIndices.length},__class__:le};function he(e,t){this._boundingBox=null,this._polyline=e,null==t&&(t=new z(0,0!=e.points.length?e.points.length-1:0)),this._interval=t}(r["verb.core.LazyPolylineBoundingBoxTree"]=he).__name__=["verb","core","LazyPolylineBoundingBoxTree"],he.__interfaces__=[$],he.prototype={split:function(){var e=this._interval.min,t=this._interval.max,n=e+Math.ceil((t-e)/2),r=new z(e,n),i=new z(n,t);return new A(new he(this._polyline,r),new he(this._polyline,i))},boundingBox:function(){return null==this._boundingBox&&(this._boundingBox=new S(this._polyline.points)),this._boundingBox},yield:function(){return this._interval.min},indivisible:function(e){return this._interval.max-this._interval.min==1},empty:function(){return this._interval.max-this._interval.min==0},__class__:he};function ce(e,t,n,r){if(null==t&&(t=!1),this._boundingBox=null,this._surface=e,this._splitV=t,null==n){var i=e.knotsU;n=(Z.last(i)-Z.first(i))/16}if(null==r){var o=e.knotsV;r=(Z.last(o)-Z.first(o))/16}this._knotTolU=n,this._knotTolV=r}(r["verb.core.LazySurfaceBoundingBoxTree"]=ce).__name__=["verb","core","LazySurfaceBoundingBoxTree"],ce.__interfaces__=[$],ce.prototype={split:function(){t=this._splitV?(e=Z.first(this._surface.knotsV),Z.last(this._surface.knotsV)):(e=Z.first(this._surface.knotsU),Z.last(this._surface.knotsU));var e,t,n=(e+t)/2,r=Pe.surfaceSplit(this._surface,n,this._splitV);return new A(new ce(r[0],!this._splitV,this._knotTolU,this._knotTolV),new ce(r[1],!this._splitV,this._knotTolU,this._knotTolV))},boundingBox:function(){if(null==this._boundingBox){this._boundingBox=new S;for(var e=0,t=this._surface.controlPoints;e<t.length;){var n=t[e];++e,this._boundingBox.addRange(Ce.dehomogenize1d(n))}}return this._boundingBox},yield:function(){return this._surface},indivisible:function(e){var t=this._surface.knotsV;if(Z.last(t)-Z.first(t)<this._knotTolV){var n=this._surface.knotsU;return Z.last(n)-Z.first(n)<this._knotTolU}return!1},empty:function(){return!1},__class__:ce};var fe=e.core.Mat=function(){};(r["verb.core.Mat"]=fe).__name__=["verb","core","Mat"],fe.mul=function(e,t){for(var n=[],r=0,i=t.length;r<i;){var o=r++;n.push(Ve.mul(e,t[o]))}return n},fe.mult=function(e,t){var n,r,i,o,a,s,u,l;n=e.length,r=t.length,i=t[0].length,o=[];for(var h=n-1,c=0,f=0;0<=h;){for(a=[],s=e[h],f=i-1;0<=f;){for(u=s[r-1]*t[r-1][f],c=r-2;1<=c;)l=c-1,u+=s[c]*t[c][f]+s[l]*t[l][f],c-=2;0==c&&(u+=s[0]*t[0][f]),a[f]=u,--f}o[h]=a,--h}return o},fe.add=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(Ve.add(e[o],t[o]))}return n},fe.div=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(Ve.div(e[o],t))}return n},fe.sub=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(Ve.sub(e[o],t[o]))}return n},fe.dot=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(Ve.dot(e[o],t))}return n},fe.identity=function(e){for(var t=Ve.zeros2d(e,e),n=0,r=e;n<r;){var i=n++;t[i][i]=1}return t},fe.transpose=function(e){if(0==e.length)return[];for(var t=[],n=0,r=e[0].length;n<r;){for(var i=n++,o=[],a=0,s=e.length;a<s;){var u=a++;o.push(e[u][i])}t.push(o)}return t},fe.solve=function(e,t){return fe.LUsolve(fe.LU(e),t)},fe.LUsolve=function(e,t){var n,r,i,o,a,s=e.LU,u=s.length,l=t.slice(),h=e.P;for(n=u-1;-1!=n;)l[n]=t[n],--n;for(n=0;n<u;){for(i=h[n],h[n]!=n&&(a=l[n],l[n]=l[i],l[i]=a),o=s[n],r=0;r<n;)l[n]-=l[r]*o[r],++r;++n}for(n=u-1;0<=n;){for(o=s[n],r=n+1;r<u;)l[n]-=l[r]*o[r],++r;l[n]/=o[n],--n}return l},fe.LU=function(e){Math.abs;for(var t,n,r,i,o,a,s,u,l,h=[],c=0,f=e.length;c<f;){var v=c++;h.push(e[v].slice())}var _=(e=h).length,d=_-1,p=[];for(r=0;r<_;){for(a=e[s=r],l=Math.abs(a[r]),n=r+1;n<_;)l<(i=Math.abs(e[n][r]))&&(l=i,s=n),++n;for((p[r]=s)!=r&&(e[r]=e[s],e[s]=a,a=e[r]),o=a[r],t=r+1;t<_;)e[t][r]/=o,++t;for(t=r+1;t<_;){for(u=e[t],n=r+1;n<d;)u[n]-=u[r]*a[n],u[++n]-=u[r]*a[n],++n;n==d&&(u[n]-=u[r]*a[n]),++t}++r}return new ve(e,p)};var ve=function(e,t){this.LU=e,this.P=t};(r["verb.core._Mat.LUDecomp"]=ve).__name__=["verb","core","_Mat","LUDecomp"],ve.prototype={__class__:ve};var _e=e.core.Mesh=function(){};(r["verb.core.Mesh"]=_e).__name__=["verb","core","Mesh"],_e.getTriangleNorm=function(e,t){var n=e[t[0]],r=e[t[1]],i=e[t[2]],o=Ve.sub(r,n),a=Ve.sub(i,n),s=Ve.cross(o,a);return Ve.mul(1/Ve.norm(s),s)},_e.makeMeshAabb=function(e,t){for(var n=new S,r=0;r<t.length;){var i=t[r];++r,n.add(e.points[e.faces[i][0]]),n.add(e.points[e.faces[i][1]]),n.add(e.points[e.faces[i][2]])}return n},_e.sortTrianglesOnLongestAxis=function(e,t,n){for(var r=e.getLongestAxis(),i=[],o=0;o<n.length;){var a=n[o];++o;var s=_e.getMinCoordOnAxis(t.points,t.faces[a],r);i.push(new A(s,a))}i.sort(function(e,t){var n=e.item0,r=t.item0;return n==r?0:r<n?1:-1});for(var u=[],l=0,h=i.length;l<h;){var c=l++;u.push(i[c].item1)}return u},_e.getMinCoordOnAxis=function(e,t,n){for(var r=1/0,i=0;i<3;){var o=e[t[i++]][n];o<r&&(r=o)}return r},_e.getTriangleCentroid=function(e,t){for(var n=[0,0,0],r=0;r<3;)for(var i=r++,o=0;o<3;){var a=o++;n[a]+=e[t[i]][a]}for(var s=0;s<3;){n[s++]/=3}return n},_e.triangleUVFromPoint=function(e,t,n){var r=e.faces[t],i=e.points[r[0]],o=e.points[r[1]],a=e.points[r[2]],s=e.uvs[r[0]],u=e.uvs[r[1]],l=e.uvs[r[2]],h=Ve.sub(i,n),c=Ve.sub(o,n),f=Ve.sub(a,n),v=Ve.norm(Ve.cross(Ve.sub(i,o),Ve.sub(i,a))),_=Ve.norm(Ve.cross(c,f))/v,d=Ve.norm(Ve.cross(f,h))/v,p=Ve.norm(Ve.cross(h,c))/v;return Ve.add(Ve.mul(_,s),Ve.add(Ve.mul(d,u),Ve.mul(p,l)))};var de=function(e,t){if(this._empty=!1,this._face=-1,null==t){for(var n=[],r=0,i=e.faces.length;r<i;){var o=r++;n.push(o)}t=n}if(this._boundingBox=_e.makeMeshAabb(e,t),t.length<1)this._empty=!0;else if(t.length<2)this._face=t[0];else{var a=_e.sortTrianglesOnLongestAxis(this._boundingBox,e,t),s=Z.left(a),u=Z.right(a);this._children=new A(new de(e,s),new de(e,u))}};(r["verb.core.MeshBoundingBoxTree"]=de).__name__=["verb","core","MeshBoundingBoxTree"],de.__interfaces__=[$],de.prototype={split:function(){return this._children},boundingBox:function(){return this._boundingBox},yield:function(){return this._face},indivisible:function(e){return null==this._children},empty:function(){return this._empty},__class__:de};var pe=e.core.Minimizer=function(){};(r["verb.core.Minimizer"]=pe).__name__=["verb","core","Minimizer"],pe.uncmin=function(t,e,n,r,i){null==n&&(n=1e-8),null==r&&(r=function(e){return pe.numericalGradient(t,e)}),null==i&&(i=1e3);var o,a,s,u,l=(e=e.slice(0)).length,h=t(e),c=h;if(isNaN(h))throw new se("uncmin: f(x0) is a NaN!");n=Math.max(n,D.EPSILON);var f,v,_,d,p,m,g=fe.identity(l),b=0,y=[],w="";for(s=r(e);b<i;){if(!Ve.all(Ve.finite(s))){w="Gradient has Infinity or NaN";break}if(a=Ve.neg(fe.dot(g,s)),!Ve.all(Ve.finite(a))){w="Search direction has Infinity or NaN";break}if((m=Ve.norm(a))<n){w="Newton step smaller than tol";break}for(p=1,o=Ve.dot(s,a),f=e;b<i&&!(p*m<n)&&(y=Ve.mul(p,a),f=Ve.add(e,y),.1*p*o<=(c=t(f))-h||isNaN(c));)p*=.5,++b;if(p*m<n){w="Line search step size smaller than tol";break}if(b==i){w="maxit reached during line search";break}u=r(f),v=Ve.sub(u,s),d=Ve.dot(v,y),_=fe.dot(g,v),g=fe.sub(fe.add(g,fe.mul((d+Ve.dot(v,_))/(d*d),pe.tensor(y,y))),fe.div(fe.add(pe.tensor(_,y),pe.tensor(y,_)),d)),e=f,h=c,s=u,++b}return new me(e,h,s,g,b,w)},pe.numericalGradient=function(e,t){var n=t.length,r=e(t);if(NaN==r)throw new se("gradient: f(x) is a NaN!");for(var i,o,a,s,u,l,h,c,f=t.slice(0),v=[],_=0,d=0,p=n;d<p;)for(var m=d++,g=Math.max(1e-6*r,1e-8);;){if(20<++_)throw new se("Numerical gradient fails");if(f[m]=t[m]+g,i=e(f),f[m]=t[m]-g,o=e(f),f[m]=t[m],isNaN(i)||isNaN(o))g/=16;else{if(v[m]=(i-o)/(2*g),a=t[m]-g,s=t[m],u=t[m]+g,l=(i-r)/g,h=(r-o)/g,c=Ve.max([Math.abs(v[m]),Math.abs(r),Math.abs(i),Math.abs(o),Math.abs(a),Math.abs(s),Math.abs(u),1e-8]),!(.001<Math.min(Ve.max([Math.abs(l-v[m]),Math.abs(h-v[m]),Math.abs(l-h)])/c,g/c)))break;g/=16}}return v},pe.tensor=function(e,t){for(var n,r,i=e.length,o=t.length,a=[],s=i-1;0<=s;){n=[],r=e[s];for(var u=o-1;3<=u;)n[u]=r*t[u],n[--u]=r*t[u],n[--u]=r*t[u],n[--u]=r*t[u],--u;for(;0<=u;)n[u]=r*t[u],--u;a[s]=n,--s}return a};var me=function(e,t,n,r,i,o){this.solution=e,this.value=t,this.gradient=n,this.invHessian=r,this.iterations=i,this.message=o};(r["verb.core.MinimizationResult"]=me).__name__=["verb","core","MinimizationResult"],me.prototype={__class__:me};function ge(){}(r["verb.core.ISerializable"]=ge).__name__=["verb","core","ISerializable"],ge.prototype={__class__:ge};var be=e.core.Deserializer=function(){};(r["verb.core.Deserializer"]=be).__name__=["verb","core","Deserializer"],be.deserialize=function(e){return new ne(e).unserialize()};var ye=e.core.Trig=function(){};(r["verb.core.Trig"]=ye).__name__=["verb","core","Trig"],ye.isPointInPlane=function(e,t,n){return Math.abs(Ve.dot(Ve.sub(e,t.origin),t.normal))<n},ye.distToSegment=function(e,t,n){var r=ye.segmentClosestPoint(t,e,n,0,1);return Ve.dist(t,r.pt)},ye.rayClosestPoint=function(e,t,n){var r=Ve.sub(e,t),i=Ve.dot(r,n);return Ve.add(t,Ve.mul(i,n))},ye.distToRay=function(e,t,n){var r=ye.rayClosestPoint(e,t,n),i=Ve.sub(r,e);return Ve.norm(i)},ye.threePointsAreFlat=function(e,t,n,r){var i=Ve.sub(t,e),o=Ve.sub(n,e),a=Ve.cross(i,o);return Ve.dot(a,a)<r},ye.segmentClosestPoint=function(e,t,n,r,i){var o=Ve.sub(n,t),a=Ve.norm(o);if(a<D.EPSILON)return{u:r,pt:t};var s=t,u=Ve.mul(1/a,o),l=Ve.sub(e,s),h=Ve.dot(l,u);return h<0?{u:r,pt:t}:a<h?{u:i,pt:n}:{u:r+(i-r)*h/a,pt:Ve.add(s,Ve.mul(h,u))}};var Ve=e.core.Vec=function(){};(r["verb.core.Vec"]=Ve).__name__=["verb","core","Vec"],Ve.angleBetween=function(e,t){return Math.acos(Ve.dot(e,t)/(Ve.norm(e)*Ve.norm(t)))},Ve.positiveAngleBetween=function(e,t,n){var r=Ve.cross(e,t),i=Ve.norm(e)*Ve.norm(t),o=Ve.dot(e,t),a=Ve.norm(r)/i,s=o/i,u=Math.atan2(a,s),l=Ve.dot(n,r);return Math.abs(l)<D.EPSILON?u:0<l?u:-u},Ve.signedAngleBetween=function(e,t,n){var r=Ve.cross(e,t),i=Ve.norm(e)*Ve.norm(t),o=Ve.dot(e,t),a=Ve.norm(r)/i,s=o/i,u=Math.atan2(a,s);return 0<Ve.dot(n,r)?u:2*Math.PI-u},Ve.angleBetweenNormalized2d=function(e,t){var n=e[0]*t[1]-e[1]*t[0];return Math.atan2(n,Ve.dot(e,t))},Ve.domain=function(e){return Z.last(e)-Z.first(e)},Ve.range=function(e){for(var t=[],n=0,r=0,i=e;r<i;){r++;t.push(n),n+=1}return t},Ve.span=function(e,t,n){if(null==n)return[];if(n<D.EPSILON)return[];if(t<e&&0<n)return[];if(e<t&&n<0)return[];for(var r=[],i=e;i<=t;)r.push(i),i+=n;return r},Ve.neg=function(e){return e.map(function(e){return-e})},Ve.min=function(e){return N.fold(e,function(e,t){return Math.min(e,t)},1/0)},Ve.max=function(e){return N.fold(e,function(e,t){return Math.max(e,t)},-1/0)},Ve.all=function(e){return N.fold(e,function(e,t){return!!t&&e},!0)},Ve.finite=function(e){return e.map(function(e){return isFinite(e)})},Ve.onRay=function(e,t,n){return Ve.add(e,Ve.mul(n,t))},Ve.lerp=function(e,t,n){return Ve.add(Ve.mul(e,t),Ve.mul(1-e,n))},Ve.normalized=function(e){return Ve.div(e,Ve.norm(e))},Ve.cross=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},Ve.dist=function(e,t){return Ve.norm(Ve.sub(e,t))},Ve.distSquared=function(e,t){return Ve.normSquared(Ve.sub(e,t))},Ve.sum=function(e){return N.fold(e,function(e,t){return t+e},0)},Ve.addAll=function(e){var t=nt(e)();if(!t.hasNext())return null;var n=t.next().length;return N.fold(e,function(e,t){return Ve.add(t,e)},Ve.rep(n,0))},Ve.addAllMutate=function(e){for(var t=e[0],n=1,r=e.length;n<r;){var i=n++;Ve.addMutate(t,e[i])}},Ve.addMulMutate=function(e,t,n){for(var r=0,i=e.length;r<i;){var o=r++;e[o]+=t*n[o]}},Ve.subMulMutate=function(e,t,n){for(var r=0,i=e.length;r<i;){var o=r++;e[o]-=t*n[o]}},Ve.addMutate=function(e,t){for(var n=0,r=e.length;n<r;){var i=n++;e[i]+=t[i]}},Ve.subMutate=function(e,t){for(var n=0,r=e.length;n<r;){var i=n++;e[i]-=t[i]}},Ve.mulMutate=function(e,t){for(var n=0,r=t.length;n<r;){t[n++]*=e}},Ve.norm=function(e){var t=Ve.normSquared(e);return 0!=t?Math.sqrt(t):t},Ve.normSquared=function(e){return N.fold(e,function(e,t){return t+e*e},0)},Ve.rep=function(e,t){for(var n=[],r=0,i=e;r<i;){r++;n.push(t)}return n},Ve.zeros1d=function(e){for(var t=[],n=0,r=e;n<r;){n++;t.push(0)}return t},Ve.zeros2d=function(e,t){for(var n=[],r=0,i=e;r<i;){r++;n.push(Ve.zeros1d(t))}return n},Ve.zeros3d=function(e,t,n){for(var r=[],i=0,o=e;i<o;){i++;r.push(Ve.zeros2d(t,n))}return r},Ve.dot=function(e,t){for(var n=0,r=0,i=e.length;r<i;){var o=r++;n+=e[o]*t[o]}return n},Ve.add=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(e[o]+t[o])}return n},Ve.mul=function(e,t){for(var n=[],r=0,i=t.length;r<i;){var o=r++;n.push(e*t[o])}return n},Ve.div=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(e[o]/t)}return n},Ve.sub=function(e,t){for(var n=[],r=0,i=e.length;r<i;){var o=r++;n.push(e[o]-t[o])}return n},Ve.isZero=function(e){for(var t=0,n=e.length;t<n;){var r=t++;if(Math.abs(e[r])>D.TOLERANCE)return!1}return!0},Ve.sortedSetUnion=function(e,t){for(var n=[],r=0,i=0;r<e.length||i<t.length;)if(r>=e.length)n.push(t[i]),++i;else if(i>=t.length)n.push(e[r]),++r;else{var o=e[r]-t[i];Math.abs(o)<D.EPSILON?(n.push(e[r]),++r,++i):0<o?(n.push(t[i]),++i):(n.push(e[r]),++r)}return n},Ve.sortedSetSub=function(e,t){for(var n=[],r=0,i=0;r<e.length;)i>=t.length?(n.push(e[r]),++r):Math.abs(e[r]-t[i])<D.EPSILON?(++r,++i):(n.push(e[r]),++r);return n};var we=e.eval.Analyze=function(){};(r["verb.eval.Analyze"]=we).__name__=["verb","eval","Analyze"],we.knotMultiplicities=function(e){for(var t=[new Se(e[0],0)],n=t[0],r=0;r<e.length;){var i=e[r];++r,Math.abs(i-n.knot)>D.EPSILON&&(n=new Se(i,0),t.push(n)),n.inc()}return t},we.isRationalSurfaceClosed=function(e,t){null==t&&(t=!0);for(var n=t?e.controlPoints:fe.transpose(e.controlPoints),r=0,i=n[0].length;r<i;){var o=r++;if(!(Ve.dist(Z.first(n)[o],Z.last(n)[o])<D.EPSILON))return!1}return!0},we.rationalSurfaceClosestPoint=function(e,t){var n=we.rationalSurfaceClosestParam(e,t);return Ce.rationalSurfacePoint(e,n[0],n[1])},we.rationalSurfaceClosestParam=function(e,t){for(var n,r,i,o=0,a=e.knotsU[0],s=Z.last(e.knotsU),u=e.knotsV[0],l=Z.last(e.knotsV),h=we.isRationalSurfaceClosed(e),c=we.isRationalSurfaceClosed(e,!1),f=Ae.rationalSurfaceAdaptive(e,new ze),v=1/0,_=0,d=f.points.length;_<d;){var p=_++,m=f.points[p],g=Ve.normSquared(Ve.sub(t,m));g<v&&(v=g,i=f.uvs[p])}for(var b,y,w,S,k,P,x,C,M,N,A,z,E;o<5;){E=i,n=Ce.rationalSurfaceDerivatives(e,E[0],E[1],2),r=Ve.sub(n[0][0],t);var I=Ve.norm(r),L=Ve.dot(n[1][0],r),T=Ve.norm(n[1][0])*I,B=Ve.dot(n[0][1],r),U=Ve.norm(n[0][1])*I;if(I<1e-4&&L/T<5e-4&&B/U<5e-4)return i;var R=(b=i,w=r,void 0,S=(y=n)[1][0],k=y[0][1],P=y[2][0],x=y[0][2],C=y[1][1],M=y[1][1],N=[-Ve.dot(S,w),-Ve.dot(k,w)],A=[[Ve.dot(S,S)+Ve.dot(P,w),Ve.dot(S,k)+Ve.dot(C,w)],[Ve.dot(S,k)+Ve.dot(M,w),Ve.dot(k,k)+Ve.dot(x,w)]],z=fe.solve(A,N),Ve.add(z,b));if(R[0]<a?R=h?[s-(R[0]-a),R[1]]:[a+D.EPSILON,R[1]]:R[0]>s&&(R=h?[a+(R[0]-s),R[1]]:[s-D.EPSILON,R[1]]),R[1]<u?R=c?[R[0],l-(R[1]-u)]:[R[0],u+D.EPSILON]:R[1]>l&&(R=c?[R[0],u+(R[0]-l)]:[R[0],l-D.EPSILON]),Ve.norm(Ve.mul(R[0]-i[0],n[1][0]))+Ve.norm(Ve.mul(R[1]-i[1],n[0][1]))<1e-4)return i;i=R,++o}return i},we.rationalCurveClosestPoint=function(e,t){return Ce.rationalCurvePoint(e,we.rationalCurveClosestParam(e,t))},we.rationalCurveClosestParam=function(e,t){for(var n=1/0,r=0,i=Ae.rationalCurveRegularSample(e,e.controlPoints.length*e.degree,!0),o=0,a=i.length-1;o<a;){var s=o++,u=i[s][0],l=i[1+s][0],h=i[s].slice(1),c=i[1+s].slice(1),f=ye.segmentClosestPoint(t,h,c,u,l),v=Ve.norm(Ve.sub(t,f.pt));v<n&&(n=v,r=f.u)}for(var _,d,p,m,g,b=0,y=e.knots[0],w=Z.last(e.knots),S=Ve.normSquared(Ve.sub(e.controlPoints[0],Z.last(e.controlPoints)))<D.EPSILON,k=r;b<5;){g=k,_=Ce.rationalCurveDerivatives(e,g,2),d=Ve.sub(_[0],t);var P=Ve.norm(d),x=Ve.dot(_[1],d)/(Ve.norm(_[1])*P),C=P<1e-4,M=Math.abs(x)<5e-4;if(C&&M)return k;var N=(p=_,m=d,k-Ve.dot(p[1],m)/(Ve.dot(p[2],m)+Ve.dot(p[1],p[1])));if(N<y?N=S?w-(N-y):y:w<N&&(N=S?y+(N-w):w),Ve.norm(Ve.mul(N-k,_[1]))<1e-4)return k;k=N,++b}return k},we.rationalCurveParamAtArcLength=function(e,t,n,r,i){if(null==n&&(n=.001),t<D.EPSILON)return e.knots[0];for(var o=null!=r?r:Oe.decomposeCurveIntoBeziers(e),a=0,s=(o[a],-D.EPSILON),u=null!=i?i:[];s<t&&a<o.length;){if(u[a]=a<u.length?u[a]:we.rationalBezierCurveArcLength(e),t<(s+=u[a])+D.EPSILON)return we.rationalBezierCurveParamAtArcLength(e,t,n,u[a]);++a}return-1},we.rationalBezierCurveParamAtArcLength=function(e,t,n,r){if(t<0)return e.knots[0];var i,o,a,s,u,l,h=null!=r?r:we.rationalBezierCurveArcLength(e);if(h<t)return Z.last(e.knots);i=e.knots[0],o=0,a=Z.last(e.knots),s=h,l=u=0;for(var c=null!=n?n:2*D.TOLERANCE;c<s-o;)u=(i+a)/2,t<(l=we.rationalBezierCurveArcLength(e,u))?(a=u,s=l):(i=u,o=l);return(i+a)/2},we.rationalCurveArcLength=function(e,t,n){null==n&&(n=16),t=null==t?Z.last(e.knots):t;for(var r=Oe.decomposeCurveIntoBeziers(e),i=0,o=r[0],a=0;i<r.length&&o.knots[0]+D.EPSILON<t;){var s=Math.min(Z.last(o.knots),t);a+=we.rationalBezierCurveArcLength(o,s,n),o=r[++i]}return a},we.rationalBezierCurveArcLength=function(e,t,n){null==n&&(n=16);for(var r,i,o=((null==t?Z.last(e.knots):t)-e.knots[0])/2,a=0,s=e.degree+n,u=0,l=s;u<l;){var h=u++;r=o*we.Tvalues[s][h]+o+e.knots[0],i=Ce.rationalCurveDerivatives(e,r,1),a+=we.Cvalues[s][h]*Ve.norm(i[1])}return o*a};var Se=e.eval.KnotMultiplicity=function(e,t){this.knot=e,this.mult=t};(r["verb.eval.KnotMultiplicity"]=Se).__name__=["verb","eval","KnotMultiplicity"],Se.prototype={inc:function(){this.mult++},__class__:Se};var ke=e.eval.Check=function(){};(r["verb.eval.Check"]=ke).__name__=["verb","eval","Check"],ke.isValidKnotVector=function(e,t){if(0==e.length)return!1;if(e.length<2*(t+1))return!1;for(var n=Z.first(e),r=0,i=t+1;r<i;){var o=r++;if(Math.abs(e[o]-n)>D.EPSILON)return!1}n=Z.last(e);for(var a=e.length-t-1,s=e.length;a<s;){var u=a++;if(Math.abs(e[u]-n)>D.EPSILON)return!1}return ke.isNonDecreasing(e)},ke.isNonDecreasing=function(e){for(var t=Z.first(e),n=0,r=e.length;n<r;){var i=n++;if(e[i]<t-D.EPSILON)return!1;t=e[i]}return!0},ke.isValidNurbsCurveData=function(e){if(null==e.controlPoints)throw new se("Control points array cannot be null!");if(null==e.degree)throw new se("Degree cannot be null!");if(e.degree<1)throw new se("Degree must be greater than 1!");if(null==e.knots)throw new se("Knots cannot be null!");if(e.knots.length!=e.controlPoints.length+e.degree+1)throw new se("controlPoints.length + degree + 1 must equal knots.length!");if(!ke.isValidKnotVector(e.knots,e.degree))throw new se("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return e},ke.isValidNurbsSurfaceData=function(e){if(null==e.controlPoints)throw new se("Control points array cannot be null!");if(null==e.degreeU)throw new se("DegreeU cannot be null!");if(null==e.degreeV)throw new se("DegreeV cannot be null!");if(e.degreeU<1)throw new se("DegreeU must be greater than 1!");if(e.degreeV<1)throw new se("DegreeV must be greater than 1!");if(null==e.knotsU)throw new se("KnotsU cannot be null!");if(null==e.knotsV)throw new se("KnotsV cannot be null!");if(e.knotsU.length!=e.controlPoints.length+e.degreeU+1)throw new se("controlPointsU.length + degreeU + 1 must equal knotsU.length!");if(e.knotsV.length!=e.controlPoints[0].length+e.degreeV+1)throw new se("controlPointsV.length + degreeV + 1 must equal knotsV.length!");if(!ke.isValidKnotVector(e.knotsU,e.degreeU)||!ke.isValidKnotVector(e.knotsV,e.degreeV))throw new se("Invalid knot vector format!  Should begin with degree + 1 repeats and end with degree + 1 repeats!");return e};var Pe=e.eval.Divide=function(){};(r["verb.eval.Divide"]=Pe).__name__=["verb","eval","Divide"],Pe.surfaceSplit=function(e,t,n){var r,i,o;null==n&&(n=!1);for(var a=[],s=0,u=(i=n?(o=e.controlPoints,r=e.knotsV,e.degreeV):(o=fe.transpose(e.controlPoints),r=e.knotsU,e.degreeU))+1;s<u;){s++;a.push(t)}for(var l=a,h=[],c=[],f=Ce.knotSpan(i,t,r),v=null,_=0;_<o.length;){var d=o[_];++_,v=Oe.curveKnotRefine(new De(i,r,d),l),h.push(v.controlPoints.slice(0,f+1)),c.push(v.controlPoints.slice(f+1))}var p=v.knots.slice(0,f+i+2),m=v.knots.slice(f+1);return n?[new V(e.degreeU,i,e.knotsU.slice(),p,h),new V(e.degreeU,i,e.knotsU.slice(),m,c)]:(h=fe.transpose(h),c=fe.transpose(c),[new V(i,e.degreeV,p,e.knotsV.slice(),h),new V(i,e.degreeV,m,e.knotsV.slice(),c)])},Pe.curveSplit=function(e,t){for(var n=e.degree,r=(e.controlPoints,e.knots),i=[],o=0,a=n+1;o<a;){o++;i.push(t)}var s=i,u=Oe.curveKnotRefine(e,s),l=Ce.knotSpan(n,t,r),h=u.knots.slice(0,l+n+2),c=u.knots.slice(l+1),f=u.controlPoints.slice(0,l+1),v=u.controlPoints.slice(l+1);return[new De(n,h,f),new De(n,c,v)]},Pe.rationalCurveByEqualArcLength=function(e,t){var n=we.rationalCurveArcLength(e)/t;return Pe.rationalCurveByArcLength(e,n)},Pe.rationalCurveByArcLength=function(e,t){var n=Oe.decomposeCurveIntoBeziers(e),r=n.map(function(e){return we.rationalBezierCurveArcLength(e)}),i=Ve.sum(r),o=[new xe(e.knots[0],0)];if(i<t)return o;for(var a,s=t,u=0,l=s,h=0,c=0;u<n.length;){for(h+=r[u];l<h+D.EPSILON;)a=we.rationalBezierCurveParamAtArcLength(n[u],l-c,D.TOLERANCE,r[u]),o.push(new xe(a,l)),l+=s;c+=r[u],++u}return o};var xe=e.eval.CurveLengthSample=function(e,t){this.u=e,this.len=t};(r["verb.eval.CurveLengthSample"]=xe).__name__=["verb","eval","CurveLengthSample"],xe.prototype={__class__:xe};var Ce=e.eval.Eval=function(){};(r["verb.eval.Eval"]=Ce).__name__=["verb","eval","Eval"],Ce.rationalCurveTangent=function(e,t){return Ce.rationalCurveDerivatives(e,t,1)[1]},Ce.rationalSurfaceNormal=function(e,t,n){var r=Ce.rationalSurfaceDerivatives(e,t,n,1);return Ve.cross(r[1][0],r[0][1])},Ce.rationalSurfaceDerivatives=function(e,t,n,r){null==r&&(r=1);for(var i=Ce.surfaceDerivatives(e,t,n,r),o=Ce.rational2d(i),a=Ce.weight2d(i),s=[],u=o[0][0].length,l=0,h=r+1;l<h;){var c=l++;s.push([]);for(var f=0,v=r-c+1;f<v;){for(var _=f++,d=o[c][_],p=1,m=1+_;p<m;){var g=p++;Ve.subMulMutate(d,Re.get(_,g)*a[0][g],s[c][_-g])}for(var b=1,y=1+c;b<y;){var w=b++;Ve.subMulMutate(d,Re.get(c,w)*a[w][0],s[c-w][_]);for(var S=Ve.zeros1d(u),k=1,P=1+_;k<P;){var x=k++;Ve.addMulMutate(S,Re.get(_,x)*a[w][x],s[c-w][_-x])}Ve.subMulMutate(d,Re.get(c,w),S)}Ve.mulMutate(1/a[0][0],d),s[c].push(d)}}return s},Ce.rationalSurfacePoint=function(e,t,n){return Ce.dehomogenize(Ce.surfacePoint(e,t,n))},Ce.rationalCurveDerivatives=function(e,t,n){null==n&&(n=1);for(var r=Ce.curveDerivatives(e,t,n),i=Ce.rational1d(r),o=Ce.weight1d(r),a=[],s=0,u=n+1;s<u;){for(var l=s++,h=i[l],c=1,f=1+l;c<f;){var v=c++;Ve.subMulMutate(h,Re.get(l,v)*o[v],a[l-v])}Ve.mulMutate(1/o[0],h),a.push(h)}return a},Ce.rationalCurvePoint=function(e,t){return Ce.dehomogenize(Ce.curvePoint(e,t))},Ce.surfaceDerivatives=function(e,t,n,r){var i=e.knotsU.length-e.degreeU-2,o=e.knotsV.length-e.degreeV-2;return Ce.surfaceDerivativesGivenNM(i,o,e,t,n,r)},Ce.surfaceDerivativesGivenNM=function(e,t,n,r,i,o){var a=n.degreeU,s=n.degreeV,u=n.controlPoints,l=n.knotsU,h=n.knotsV;if(!Ce.areValidRelations(a,u.length,l.length)||!Ce.areValidRelations(s,u[0].length,h.length))throw new se("Invalid relations between control points, knot vector, and n");for(var c=u[0][0].length,f=o<a?o:a,v=o<s?o:s,_=Ve.zeros3d(o+1,o+1,c),d=Ce.knotSpanGivenN(e,a,r,l),p=Ce.knotSpanGivenN(t,s,i,h),m=Ce.derivativeBasisFunctionsGivenNI(d,r,a,e,l),g=Ce.derivativeBasisFunctionsGivenNI(p,i,s,t,h),b=Ve.zeros2d(s+1,c),y=0,w=f+1;y<w;){for(var S=y++,k=0,P=s+1;k<P;){var x=k++;b[x]=Ve.zeros1d(c);for(var C=0,M=a+1;C<M;){var N=C++;Ve.addMulMutate(b[x],m[S][N],u[d-a+N][p-s+x])}}for(var A=o-S,z=0,E=(A<v?A:v)+1;z<E;){var I=z++;_[S][I]=Ve.zeros1d(c);for(var L=0,T=s+1;L<T;){var B=L++;Ve.addMulMutate(_[S][I],g[I][B],b[B])}}}return _},Ce.surfacePoint=function(e,t,n){var r=e.knotsU.length-e.degreeU-2,i=e.knotsV.length-e.degreeV-2;return Ce.surfacePointGivenNM(r,i,e,t,n)},Ce.surfacePointGivenNM=function(e,t,n,r,i){var o=n.degreeU,a=n.degreeV,s=n.controlPoints,u=n.knotsU,l=n.knotsV;if(!Ce.areValidRelations(o,s.length,u.length)||!Ce.areValidRelations(a,s[0].length,l.length))throw new se("Invalid relations between control points, knot vector, and n");for(var h=s[0][0].length,c=Ce.knotSpanGivenN(e,o,r,u),f=Ce.knotSpanGivenN(t,a,i,l),v=Ce.basisFunctionsGivenKnotSpanIndex(c,r,o,u),_=Ce.basisFunctionsGivenKnotSpanIndex(f,i,a,l),d=c-o,p=f,m=Ve.zeros1d(h),g=Ve.zeros1d(h),b=0,y=a+1;b<y;){var w=b++;g=Ve.zeros1d(h),p=f-a+w;for(var S=0,k=o+1;S<k;){var P=S++;Ve.addMulMutate(g,v[P],s[d+P][p])}Ve.addMulMutate(m,_[w],g)}return m},Ce.curveRegularSamplePoints=function(e,t){for(var n=Ce.curveDerivatives(e,e.knots[0],e.degree),r=1/t,i=r*r,o=n[0],a=Ve.mul(r,n[1]),s=Ve.mul(.5*i,n[2]),u=Ve.mul(i*r*.5,n[3]),l=Ve.add(s,s),h=Ve.add(u,u),c=Ve.mul(.3333333333333333,u),f=[],v=0,_=t+1;v<_;){v++;f.push(Ce.dehomogenize(o)),Ve.addAllMutate([o,a,s,c]),Ve.addAllMutate([a,l,u]),Ve.addAllMutate([l,h]),Ve.addAllMutate([s,u])}return f},Ce.curveRegularSamplePoints2=function(e,t){for(var n=Ce.curveDerivatives(e,e.knots[0],e.degree),r=1/t,i=r*r,o=n[0],a=Ve.mul(r,n[1]),s=Ve.mul(.5*i,n[2]),u=Ve.mul(i*r*.5,n[3]),l=Ve.add(s,s),h=Ve.add(u,u),c=Ve.mul(.3333333333333333,u),f=[],v=0,_=t+1;v<_;){v++;f.push(Ce.dehomogenize(o)),Ve.addAllMutate([o,a,s,c]),Ve.addAllMutate([a,l,u]),Ve.addAllMutate([l,h]),Ve.addAllMutate([s,u])}return f},Ce.rationalSurfaceRegularSampleDerivatives=function(e,t,n,r){for(var i=Ce.surfaceRegularSampleDerivatives(e,t,n,r),o=[],a=n+1,s=r+1,u=0,l=t+1;u<l;){var h=u++,c=[];o.push(c);for(var f=0,v=a;f<v;){for(var _=f++,d=i[h][_],p=Ce.rational2d(d),m=Ce.weight2d(d),g=[],b=p[0][0].length,y=0,w=s;y<w;){var S=y++;g.push([]);for(var k=0,P=s-S;k<P;){for(var x=k++,C=p[S][x],M=1,N=1+x;M<N;){var A=M++;Ve.subMulMutate(C,Re.get(x,A)*m[0][A],g[S][x-A])}for(var z=1,E=1+S;z<E;){var I=z++;Ve.subMulMutate(C,Re.get(S,I)*m[I][0],g[S-I][x]);for(var L=Ve.zeros1d(b),T=1,B=1+x;T<B;){var U=T++;Ve.addMulMutate(L,Re.get(x,U)*m[I][U],g[S-I][x-U])}Ve.subMulMutate(C,Re.get(S,I),L)}Ve.mulMutate(1/m[0][0],C),g[S].push(C)}}c.push(g)}}return o},Ce.surfaceRegularSampleDerivatives=function(e,t,n,r){for(var i=e.degreeU,o=e.degreeV,a=e.controlPoints,s=e.knotsU,u=e.knotsV,l=a[0][0].length,h=(Z.last(s),s[0],Z.last(u),u[0],Ce.regularlySpacedDerivativeBasisFunctions(i,s,t)),c=h.item0,f=h.item1,v=Ce.regularlySpacedDerivativeBasisFunctions(o,u,n),_=v.item0,d=v.item1,p=[],m=n+1,g=0,b=t+1;g<b;){var y=g++,w=[];p.push(w);for(var S=0,k=m;S<k;){var P=S++;w.push(Ce.surfaceDerivativesGivenBasesKnotSpans(i,o,a,c[y],_[P],f[y],d[P],l,r))}}return p},Ce.rationalSurfaceRegularSamplePoints=function(e,t,n){return Ce.dehomogenize2d(Ce.surfaceRegularSamplePoints(e,t,n))},Ce.surfaceRegularSamplePoints=function(e,t,n){for(var r=e.degreeU,i=e.degreeV,o=e.controlPoints,a=e.knotsU,s=e.knotsV,u=o[0][0].length,l=(Z.last(a),a[0],Z.last(s),s[0],Ce.regularlySpacedBasisFunctions(r,a,t)),h=l.item0,c=l.item1,f=Ce.regularlySpacedBasisFunctions(i,s,n),v=f.item0,_=f.item1,d=[],p=n+1,m=0,g=t+1;m<g;){var b=m++,y=[];d.push(y);for(var w=0,S=p;w<S;){var k=w++;y.push(Ce.surfacePointGivenBasesKnotSpans(r,i,o,h[b],v[k],c[b],_[k],u))}}return d},Ce.regularlySpacedBasisFunctions=function(e,t,n){for(var r=t.length-e-2,i=(Z.last(t)-t[0])/n,o=[],a=[],s=t[0],u=Ce.knotSpanGivenN(r,e,s,t),l=0,h=n+1;l<h;){for(l++;s>=t[u+1];)++u;a.push(u),o.push(Ce.basisFunctionsGivenKnotSpanIndex(u,s,e,t)),s+=i}return new A(a,o)},Ce.regularlySpacedDerivativeBasisFunctions=function(e,t,n){for(var r=t.length-e-2,i=(Z.last(t)-t[0])/n,o=[],a=[],s=t[0],u=Ce.knotSpanGivenN(r,e,s,t),l=0,h=n+1;l<h;){for(l++;s>=t[u+1];)++u;a.push(u),o.push(Ce.derivativeBasisFunctionsGivenNI(u,s,e,r,t)),s+=i}return new A(a,o)},Ce.surfacePointGivenBasesKnotSpans=function(e,t,n,r,i,o,a,s){for(var u,l=Ve.zeros1d(s),h=r-e,c=i-t,f=0,v=t+1;f<v;){var _=f++;u=Ve.zeros1d(s);for(var d=0,p=e+1;d<p;){var m=d++;Ve.addMulMutate(u,o[m],n[h+m][c])}++c,Ve.addMulMutate(l,a[_],u)}return l},Ce.surfaceDerivativesGivenBasesKnotSpans=function(e,t,n,r,i,o,a,s,u){for(var l=n[0][0].length,h=u<e?u:e,c=u<t?u:t,f=Ve.zeros3d(h+1,c+1,l),v=Ve.zeros2d(t+1,l),_=0,d=h+1;_<d;){for(var p=_++,m=0,g=t+1;m<g;){var b=m++;v[b]=Ve.zeros1d(l);for(var y=0,w=e+1;y<w;){var S=y++;Ve.addMulMutate(v[b],o[p][S],n[r-e+S][i-t+b])}}for(var k=u-p,P=0,x=(k<c?k:c)+1;P<x;){var C=P++;f[p][C]=Ve.zeros1d(l);for(var M=0,N=t+1;M<N;){var A=M++;Ve.addMulMutate(f[p][C],a[C][A],v[A])}}}return f},Ce.curveDerivatives=function(e,t,n){var r=e.knots.length-e.degree-2;return Ce.curveDerivativesGivenN(r,e,t,n)},Ce.curveDerivativesGivenN=function(e,t,n,r){var i=t.degree,o=t.controlPoints,a=t.knots;if(!Ce.areValidRelations(i,o.length,a.length))throw new se("Invalid relations between control points, knot vector, and n");for(var s=o[0].length,u=r<i?r:i,l=Ve.zeros2d(r+1,s),h=Ce.knotSpanGivenN(e,i,n,a),c=Ce.derivativeBasisFunctionsGivenNI(h,n,i,u,a),f=0,v=u+1;f<v;)for(var _=f++,d=0,p=i+1;d<p;){var m=d++;Ve.addMulMutate(l[_],c[_][m],o[h-i+m])}return l},Ce.curvePoint=function(e,t){var n=e.knots.length-e.degree-2;return Ce.curvePointGivenN(n,e,t)},Ce.areValidRelations=function(e,t,n){return t+e+1-n==0},Ce.curvePointGivenN=function(e,t,n){var r=t.degree,i=t.controlPoints,o=t.knots;if(!Ce.areValidRelations(r,i.length,o.length))throw new se("Invalid relations between control points, knot Array, and n");for(var a=Ce.knotSpanGivenN(e,r,n,o),s=Ce.basisFunctionsGivenKnotSpanIndex(a,n,r,o),u=Ve.zeros1d(i[0].length),l=0,h=r+1;l<h;){var c=l++;Ve.addMulMutate(u,s[c],i[a-r+c])}return u},Ce.volumePoint=function(e,t,n,r){var i=e.knotsU.length-e.degreeU-2,o=e.knotsV.length-e.degreeV-2,a=e.knotsW.length-e.degreeW-2;return Ce.volumePointGivenNML(e,i,o,a,t,n,r)},Ce.volumePointGivenNML=function(e,t,n,r,i,o,a){if(!Ce.areValidRelations(e.degreeU,e.controlPoints.length,e.knotsU.length)||!Ce.areValidRelations(e.degreeV,e.controlPoints[0].length,e.knotsV.length)||!Ce.areValidRelations(e.degreeW,e.controlPoints[0][0].length,e.knotsW.length))throw new se("Invalid relations between control points and knot vector");for(var s=e.controlPoints,u=e.degreeU,l=e.degreeV,h=e.degreeW,c=e.knotsU,f=e.knotsV,v=e.knotsW,_=s[0][0][0].length,d=Ce.knotSpanGivenN(t,u,i,c),p=Ce.knotSpanGivenN(n,l,o,f),m=Ce.knotSpanGivenN(r,h,a,v),g=Ce.basisFunctionsGivenKnotSpanIndex(d,i,u,c),b=Ce.basisFunctionsGivenKnotSpanIndex(p,o,l,f),y=Ce.basisFunctionsGivenKnotSpanIndex(m,a,h,v),w=d-u,S=Ve.zeros1d(_),k=Ve.zeros1d(_),P=Ve.zeros1d(_),x=0,C=h+1;x<C;){var M=x++;P=Ve.zeros1d(_);for(var N=m-h+M,A=0,z=l+1;A<z;){var E=A++;k=Ve.zeros1d(_);for(var I=p-l+E,L=0,T=u+1;L<T;){var B=L++;Ve.addMulMutate(k,g[B],s[w+B][I][N])}Ve.addMulMutate(P,b[E],k)}Ve.addMulMutate(S,y[M],P)}return S},Ce.derivativeBasisFunctions=function(e,t,n){var r=Ce.knotSpan(t,e,n),i=n.length-1-t-1;return Ce.derivativeBasisFunctionsGivenNI(r,e,t,i,n)},Ce.derivativeBasisFunctionsGivenNI=function(e,t,n,r,i){for(var o=Ve.zeros2d(n+1,n+1),a=Ve.zeros1d(n+1),s=Ve.zeros1d(n+1),u=0,l=0,h=o[0][0]=1,c=n+1;h<c;){var f=h++;a[f]=t-i[e+1-f],s[f]=i[e+f]-t;for(var v=u=0,_=f;v<_;){var d=v++;o[f][d]=s[1+d]+a[f-d],l=o[d][f-1]/o[f][d],o[d][f]=u+s[1+d]*l,u=a[f-d]*l}o[f][f]=u}for(var p=Ve.zeros2d(r+1,n+1),m=Ve.zeros2d(2,n+1),g=0,b=1,y=0,w=0,S=0,k=0,P=n+1;k<P;){var x=k++;p[0][x]=o[x][n]}for(var C=0,M=n+1;C<M;){var N=C++;b=1;for(var A=m[g=0][0]=1,z=r+1;A<z;){var E=A++;y=0,w=N-E,S=n-E,E<=N&&(m[b][0]=m[g][0]/o[S+1][w],y=m[b][0]*o[w][S]);for(var I=-1<=w?1:-w,L=(N-1<=S?E-1:n-N)+1;I<L;){var T=I++;m[b][T]=(m[g][T]-m[g][T-1])/o[S+1][w+T],y+=m[b][T]*o[w+T][S]}N<=S&&(m[b][E]=-m[g][E-1]/o[S+1][N],y+=m[b][E]*o[N][S]),p[E][N]=y;var B=g;g=b,b=B}}for(var U=n,R=1,D=r+1;R<D;){for(var V=R++,O=0,F=n+1;O<F;){var j=O++;p[V][j]*=U}U*=n-V}return p},Ce.basisFunctions=function(e,t,n){var r=Ce.knotSpan(t,e,n);return Ce.basisFunctionsGivenKnotSpanIndex(r,e,t,n)},Ce.basisFunctionsGivenKnotSpanIndex=function(e,t,n,r){for(var i=Ve.zeros1d(n+1),o=Ve.zeros1d(n+1),a=Ve.zeros1d(n+1),s=0,u=0,l=i[0]=1,h=n+1;l<h;){var c=l++;o[c]=t-r[e+1-c],a[c]=r[e+c]-t;for(var f=s=0,v=c;f<v;){var _=f++;u=i[_]/(a[1+_]+o[c-_]),i[_]=s+a[1+_]*u,s=o[c-_]*u}i[c]=s}return i},Ce.knotSpan=function(e,t,n){return Ce.knotSpanGivenN(n.length-e-2,e,t,n)},Ce.knotSpanGivenN=function(e,t,n,r){if(n>r[e+1]-D.EPSILON)return e;if(n<r[t]+D.EPSILON)return t;for(var i=t,o=e+1,a=Math.floor((i+o)/2);n<r[a]||n>=r[a+1];)n<r[a]?o=a:i=a,a=Math.floor((i+o)/2);return a},Ce.dehomogenize=function(e){for(var t=[],n=e[e.length-1],r=0,i=e.length-1;r<i;){var o=r++;t.push(e[o]/n)}return t},Ce.rational1d=function(e){var t=e[0].length-1;return e.map(function(e){return e.slice(0,t)})},Ce.rational2d=function(e){return e.map(Ce.rational1d)},Ce.weight1d=function(e){var t=e[0].length-1;return e.map(function(e){return e[t]})},Ce.weight2d=function(e){return e.map(Ce.weight1d)},Ce.dehomogenize1d=function(e){return e.map(Ce.dehomogenize)},Ce.dehomogenize2d=function(e){return e.map(Ce.dehomogenize1d)},Ce.homogenize1d=function(e,t){for(var n=e.length,r=e[0].length,i=[],o=0,a=[],s=null!=t?t:Ve.rep(e.length,1),u=0,l=n;u<l;){var h=u++,c=[];a=e[h],o=s[h];for(var f=0,v=r;f<v;){var _=f++;c.push(a[_]*o)}c.push(o),i.push(c)}return i},Ce.homogenize2d=function(e,t){var n,r=e.length,i=[];if(null!=t)n=t;else{for(var o=[],a=0,s=r;a<s;){a++;o.push(Ve.rep(e[0].length,1))}n=o}for(var u=0,l=r;u<l;){var h=u++;i.push(Ce.homogenize1d(e[h],n[h]))}return i};var Me=e.eval.Intersect=function(){};(r["verb.eval.Intersect"]=Me).__name__=["verb","eval","Intersect"],Me.surfaces=function(t,n,r){var e=Ae.rationalSurfaceAdaptive(t),i=Ae.rationalSurfaceAdaptive(n);return Me.meshes(e,i).map(function(e){return e.map(function(e){return Me.surfacesAtPointWithEstimate(t,n,e.uv0,e.uv1,r)})}).map(function(e){return Ne.rationalInterpCurve(e.map(function(e){return e.point}),3)})},Me.surfacesAtPointWithEstimate=function(e,t,n,r,i){for(var o,a,s,u,l,h,c,f,v,_,d,p,m,g=0;a=(o=Ce.rationalSurfaceDerivatives(e,n[0],n[1],1))[0][0],u=o[1][0],l=o[0][1],s=Ve.normalized(Ve.cross(u,l)),h=Ve.dot(s,a),f=(c=Ce.rationalSurfaceDerivatives(t,r[0],r[1],1))[0][0],_=c[1][0],d=c[0][1],v=Ve.normalized(Ve.cross(_,d)),p=Ve.dot(v,f),!((m=Ve.distSquared(a,f))<i*i);){var b=Ve.normalized(Ve.cross(s,v)),y=Ve.dot(b,a),w=Me.threePlanes(s,h,v,p,b,y);if(null==w)throw new se("panic!");var S=Ve.sub(w,a),k=Ve.sub(w,f),P=Ve.cross(u,s),x=Ve.cross(l,s),C=Ve.cross(_,v),M=Ve.cross(d,v),N=Ve.dot(x,S)/Ve.dot(x,u),A=Ve.dot(P,S)/Ve.dot(P,l),z=Ve.dot(M,k)/Ve.dot(M,_),E=Ve.dot(C,k)/Ve.dot(C,d);if(n=Ve.add([N,A],n),r=Ve.add([z,E],r),!(++g<5))break}return new U(n,r,a,m)},Me.meshes=function(t,n,e,r){null==e&&(e=new le(t)),null==r&&(r=new le(n));var i=Me.boundingBoxTrees(e,r,0),o=Z.unique(i.map(function(e){return Me.triangles(t,e.item0,n,e.item1)}).filter(function(e){return null!=e}).filter(function(e){return Ve.distSquared(e.min.point,e.max.point)>D.EPSILON}),function(e,t){var n=Ve.sub(e.min.uv0,t.min.uv0),r=Ve.dot(n,n),i=Ve.sub(e.max.uv0,t.max.uv0),o=Ve.dot(i,i),a=Ve.sub(e.min.uv0,t.max.uv0),s=Ve.dot(a,a),u=Ve.sub(e.max.uv0,t.min.uv0),l=Ve.dot(u,u);return r<D.EPSILON&&o<D.EPSILON||s<D.EPSILON&&l<D.EPSILON});return Me.makeMeshIntersectionPolylines(o)},Me.meshSlices=function(e,t,n,r){for(var i=new de(e),o=i.boundingBox(),a=o.min[0],s=o.min[1],u=o.max[0],l=o.max[1],h=Ve.span(t,n,r),c=[],f=0;f<h.length;){var v=h[f];++f;var _=new I([[0,1,2],[0,2,3]],[[a,s,v],[u,s,v],[u,l,v],[a,l,v]],null,[[0,0],[1,0],[1,1],[0,1]]);c.push(Me.meshes(e,_,i))}return c},Me.makeMeshIntersectionPolylines=function(e){if(0==e.length)return[];for(var t=0;t<e.length;){var n=e[t];++t,n.max.opp=n.min,n.min.opp=n.max}for(var r=Me.kdTreeFromSegments(e),i=[],o=0;o<e.length;){var a=e[o];++o,i.push(a.min),i.push(a.max)}for(var s=0;s<i.length;){var u=i[s];if(++s,null==u.adj){var l=Me.lookupAdjacentSegment(u,r,e.length);null!=l&&null==l.adj&&((u.adj=l).adj=u)}}var h=i.filter(function(e){return null==e.adj});0==h.length&&(h=i);for(var c=[],f=0,v=!1;0!=h.length;){var _=h.pop();if(!_.visited){for(var d=[],p=_;null!=p&&!p.visited&&(p.visited=!0,p.opp.visited=!0,d.push(p),f+=2,(p=p.opp.adj)!=_););0<d.length&&(d.push(d[d.length-1].opp),c.push(d))}if(0==h.length&&0<i.length&&(v||f<i.length)){v=!0;var m=i.pop();h.push(m)}}return c},Me.kdTreeFromSegments=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];++n,t.push(new Y(r.min.point,r.min)),t.push(new Y(r.max.point,r.max))}return new H(t,Ve.distSquared)},Me.lookupAdjacentSegment=function(t,e,n){var r=e.nearest(t.point,n,D.EPSILON).filter(function(e){return t!=e.item0.obj}).map(function(e){return e.item0.obj});return 1==r.length?r[0]:null},Me.curveAndSurface=function(e,t,o,n,r){null==o&&(o=.001),n=null!=n?n:new ue(e),r=null!=r?r:new ce(t);var i=Me.boundingBoxTrees(n,r,o);return Z.unique(i.map(function(e){var t=e.item0,n=e.item1,r=(Z.first(t.knots)+Z.last(t.knots))/2,i=[(Z.first(n.knotsU)+Z.last(n.knotsU))/2,(Z.first(n.knotsV)+Z.last(n.knotsV))/2];return Me.curveAndSurfaceWithEstimate(t,n,[r].concat(i),o)}).filter(function(e){return Ve.distSquared(e.curvePoint,e.surfacePoint)<o*o}),function(e,t){return Math.abs(e.u-t.u)<.5*o})},Me.curveAndSurfaceWithEstimate=function(s,u,e,t){null==t&&(t=.001);var n=pe.uncmin(function(e){var t=Ce.rationalCurvePoint(s,e[0]),n=Ce.rationalSurfacePoint(u,e[1],e[2]),r=Ve.sub(t,n);return Ve.dot(r,r)},e,t*t,function(e){var t=Ce.rationalCurveDerivatives(s,e[0],1),n=Ce.rationalSurfaceDerivatives(u,e[1],e[2],1),r=Ve.sub(n[0][0],t[0]),i=Ve.mul(-1,t[1]),o=n[1][0],a=n[0][1];return[2*Ve.dot(i,r),2*Ve.dot(o,r),2*Ve.dot(a,r)]}).solution;return new L(n[0],[n[1],n[2]],Ce.rationalCurvePoint(s,n[0]),Ce.rationalSurfacePoint(u,n[1],n[2]))},Me.polylineAndMesh=function(e,t,n){for(var r=Me.boundingBoxTrees(new he(e),new le(t),n),i=[],o=0;o<r.length;){var a=r[o];++o;var s=a.item0,u=a.item1,l=Me.segmentWithTriangle(e.points[s],e.points[s+1],t.points,t.faces[u]);if(null!=l){var h=l.point,c=Ve.lerp(l.p,[e.params[s]],[e.params[s+1]])[0],f=_e.triangleUVFromPoint(t,u,h);i.push(new B(h,c,f,s,u))}}return i},Me.boundingBoxTrees=function(e,t,n){null==n&&(n=1e-9);var r=[],i=[];r.push(e),i.push(t);for(var o=[];0<r.length;){var a=r.pop(),s=i.pop();if(!a.empty()&&!s.empty()&&a.boundingBox().intersects(s.boundingBox(),n)){var u=a.indivisible(n),l=s.indivisible(n);if(u&&l)o.push(new A(a.yield(),s.yield()));else if(!u||l)if(u||!l){var h=a.split(),c=s.split();r.push(h.item1),i.push(c.item1),r.push(h.item1),i.push(c.item0),r.push(h.item0),i.push(c.item1),r.push(h.item0),i.push(c.item0)}else{var f=a.split();r.push(f.item1),i.push(s),r.push(f.item0),i.push(s)}else{var v=s.split();r.push(a),i.push(v.item1),r.push(a),i.push(v.item0)}}}return o},Me.curves=function(r,i,o){var e=Me.boundingBoxTrees(new ue(r),new ue(i),0);return Z.unique(e.map(function(e){var t=Z.first(e.item0.knots),n=Z.first(e.item1.knots);return Me.curvesWithEstimate(r,i,t,n,o)}).filter(function(e){return Ve.distSquared(e.point0,e.point1)<o}),function(e,t){return Math.abs(e.u0-t.u0)<5*o})},Me.curvesWithEstimate=function(a,s,e,t,n){var r=pe.uncmin(function(e){var t=Ce.rationalCurvePoint(a,e[0]),n=Ce.rationalCurvePoint(s,e[1]),r=Ve.sub(t,n);return Ve.dot(r,r)},[e,t],n*n,function(e){var t=Ce.rationalCurveDerivatives(a,e[0],1),n=Ce.rationalCurveDerivatives(s,e[1],1),r=Ve.sub(t[0],n[0]),i=t[1],o=Ve.mul(-1,n[1]);return[2*Ve.dot(i,r),2*Ve.dot(o,r)]}),i=r.solution[0],o=r.solution[1],u=Ce.rationalCurvePoint(a,i),l=Ce.rationalCurvePoint(s,o);return new E(u,l,i,o)},Me.triangles=function(e,t,n,r){var i=e.faces[t],o=n.faces[r],a=_e.getTriangleNorm(e.points,i),s=_e.getTriangleNorm(n.points,o),u=e.points[i[0]],l=n.points[o[0]],h=Me.planes(u,a,l,s);if(null==h)return null;var c=Me.clipRayInCoplanarTriangle(h,e,t);if(null==c)return null;var f=Me.clipRayInCoplanarTriangle(h,n,r);if(null==f)return null;var v=Me.mergeTriangleClipIntervals(c,f,e,t,n,r);return null==v?null:new z(new T(v.min.uv0,v.min.uv1,v.min.point,t,r),new T(v.max.uv0,v.max.uv1,v.max.point,t,r))},Me.clipRayInCoplanarTriangle=function(e,t,n){for(var r=t.faces[n],i=[t.points[r[0]],t.points[r[1]],t.points[r[2]]],o=[t.uvs[r[0]],t.uvs[r[1]],t.uvs[r[2]]],a=[Ve.sub(o[1],o[0]),Ve.sub(o[2],o[1]),Ve.sub(o[0],o[2])],s=[Ve.sub(i[1],i[0]),Ve.sub(i[2],i[1]),Ve.sub(i[0],i[2])],u=s.map(Ve.normalized),l=s.map(Ve.norm),h=null,c=null,f=0;f<3;){var v=f++,_=i[v],d=u[v],p=Me.rays(_,d,e.origin,e.dir);if(null!=p){var m=p.u0,g=p.u1;m<-D.EPSILON||m>l[v]+D.EPSILON||((null==h||g<h.u)&&(h=new O(g,Ve.onRay(e.origin,e.dir,g),Ve.onRay(o[v],a[v],m/l[v]))),(null==c||g>c.u)&&(c=new O(g,Ve.onRay(e.origin,e.dir,g),Ve.onRay(o[v],a[v],m/l[v]))))}}return null==c||null==h?null:new z(h,c)},Me.mergeTriangleClipIntervals=function(e,t,n,r,i,o){if(t.min.u>e.max.u+D.EPSILON||e.min.u>t.max.u+D.EPSILON)return null;var a=e.min.u>t.min.u?new A(e.min,0):new A(t.min,1),s=e.max.u<t.max.u?new A(e.max,0):new A(t.max,1),u=new z(new T(null,null,a.item0.point,r,o),new T(null,null,s.item0.point,r,o));return 0==a.item1?(u.min.uv0=a.item0.uv,u.min.uv1=_e.triangleUVFromPoint(i,o,a.item0.point)):(u.min.uv0=_e.triangleUVFromPoint(n,r,a.item0.point),u.min.uv1=a.item0.uv),0==s.item1?(u.max.uv0=s.item0.uv,u.max.uv1=_e.triangleUVFromPoint(i,o,s.item0.point)):(u.max.uv0=_e.triangleUVFromPoint(n,r,s.item0.point),u.max.uv1=s.item0.uv),u},Me.planes=function(e,t,n,r){var i=Ve.cross(t,r);if(Ve.dot(i,i)<D.EPSILON)return null;var o,a,s,u,l=0,h=Math.abs(i[0]),c=Math.abs(i[1]),f=Math.abs(i[2]);h<c&&(l=1,h=c),h<f&&(l=2,h=f),u=0==l?(o=t[1],a=t[2],s=r[1],r[2]):1==l?(o=t[0],a=t[2],s=r[0],r[2]):(o=t[0],a=t[1],s=r[0],r[1]);var v=-Ve.dot(e,t),_=-Ve.dot(n,r),d=o*u-a*s,p=(a*_-v*u)/d,m=(v*s-o*_)/d;return new x(0==l?[0,p,m]:1==l?[p,0,m]:[p,m,0],Ve.normalized(i))},Me.threePlanes=function(e,t,n,r,i,o){var a=Ve.cross(n,i),s=Ve.dot(e,a);if(Math.abs(s)<D.EPSILON)return null;var u=Ve.sub(Ve.mul(o,n),Ve.mul(r,i)),l=Ve.add(Ve.mul(t,a),Ve.cross(e,u));return Ve.mul(1/s,l)},Me.polylines=function(e,t,n){for(var r=Me.boundingBoxTrees(new he(e),new he(t),n),i=[],o=0;o<r.length;){var a=r[o];++o;var s=a.item0,u=a.item1,l=Me.segments(e.points[s],e.points[s+1],t.points[u],t.points[u+1],n);null!=l&&(l.u0=Ve.lerp(l.u0,[e.params[s]],[e.params[s+1]])[0],l.u1=Ve.lerp(l.u1,[t.params[u]],[t.params[u+1]])[0],i.push(l))}return i},Me.segments=function(e,t,n,r,i){var o=Ve.sub(t,e),a=Math.sqrt(Ve.dot(o,o)),s=Ve.mul(1/a,o),u=Ve.sub(r,n),l=Math.sqrt(Ve.dot(u,u)),h=Ve.mul(1/l,u),c=Me.rays(e,s,n,h);if(null!=c){var f=Math.min(Math.max(0,c.u0/a),1),v=Math.min(Math.max(0,c.u1/l),1),_=Ve.onRay(e,o,f),d=Ve.onRay(n,u,v);if(Ve.distSquared(_,d)<i*i)return new E(_,d,f,v)}return null},Me.rays=function(e,t,n,r){var i=Ve.dot(t,r),o=Ve.dot(t,n),a=Ve.dot(t,e),s=Ve.dot(r,n),u=Ve.dot(r,e),l=Ve.dot(t,t),h=l*Ve.dot(r,r)-i*i;if(Math.abs(h)<D.EPSILON)return null;var c=(i*(o-a)-l*(s-u))/h,f=(o-a+c*i)/l,v=Ve.onRay(e,t,f),_=Ve.onRay(n,r,c);return new E(v,_,f,c)},Me.segmentWithTriangle=function(e,t,n,r){var i=n[r[0]],o=n[r[1]],a=n[r[2]],s=Ve.sub(o,i),u=Ve.sub(a,i),l=Ve.cross(s,u),h=Ve.sub(t,e),c=Ve.sub(e,i),f=-Ve.dot(l,c),v=Ve.dot(l,h);if(Math.abs(v)<D.EPSILON)return null;var _=f/v;if(_<0||1<_)return null;var d=Ve.add(e,Ve.mul(_,h)),p=Ve.dot(s,u),m=Ve.dot(s,s),g=Ve.dot(u,u),b=Ve.sub(d,i),y=Ve.dot(b,s),w=Ve.dot(b,u),S=p*p-m*g;if(Math.abs(S)<D.EPSILON)return null;var k=(p*w-g*y)/S,P=(p*y-m*w)/S;return k>1+D.EPSILON||P>1+D.EPSILON||P<-D.EPSILON||k<-D.EPSILON||k+P>1+D.EPSILON?null:new R(d,k,P,_)},Me.segmentAndPlane=function(e,t,n,r){var i=Ve.dot(r,Ve.sub(t,e));if(Math.abs(i)<D.EPSILON)return null;var o=Ve.dot(r,Ve.sub(n,e))/i;return o>1+D.EPSILON||o<-D.EPSILON?null:{p:o}};var Ne=e.eval.Make=function(){};(r["verb.eval.Make"]=Ne).__name__=["verb","eval","Make"],Ne.rationalTranslationalSurface=function(e,t){for(var n=Ce.rationalCurvePoint(t,Z.first(t.knots)),r=Z.first(t.knots),i=Z.last(t.knots),o=2*t.controlPoints.length,a=(i-r)/(o-1),s=[],u=0,l=o;u<l;){var h=u++,c=Ve.sub(Ce.rationalCurvePoint(t,r+h*a),n),f=Oe.rationalCurveTransform(e,[[1,0,0,c[0]],[0,1,0,c[1]],[0,0,1,c[2]],[0,0,0,1]]);s.push(f)}return Ne.loftedSurface(s)},Ne.surfaceBoundaryCurves=function(e){return[Ne.surfaceIsocurve(e,Z.first(e.knotsU),!1),Ne.surfaceIsocurve(e,Z.last(e.knotsU),!1),Ne.surfaceIsocurve(e,Z.first(e.knotsV),!0),Ne.surfaceIsocurve(e,Z.last(e.knotsV),!0)]},Ne.surfaceIsocurve=function(e,t,n){null==n&&(n=!1);for(var r=n?e.knotsV:e.knotsU,i=n?e.degreeV:e.degreeU,o=we.knotMultiplicities(r),a=-1,s=0,u=o.length;s<u;){var l=s++;if(Math.abs(t-o[l].knot)<D.EPSILON){a=l;break}}var h=i+1;0<=a&&(h-=o[a].mult);var c=0<h?Oe.surfaceKnotRefine(e,Ve.rep(h,t),n):e,f=Ce.knotSpan(i,t,r);if(Math.abs(t-Z.first(r))<D.EPSILON?f=0:Math.abs(t-Z.last(r))<D.EPSILON&&(f=(n?c.controlPoints[0].length:c.controlPoints.length)-1),n){for(var v=c.degreeU,_=c.knotsU,d=[],p=0,m=c.controlPoints;p<m.length;){var g=m[p];++p,d.push(g[f])}return new De(v,_,d)}return new De(c.degreeV,c.knotsV,c.controlPoints[f])},Ne.loftedSurface=function(e,t){var n=(e=Oe.unifyCurveKnotVectors(e))[0].degree;null==t&&(t=3),t>e.length-1&&(t=e.length-1);for(var r=e[0].knots,i=[],o=[],a=0,s=e[0].controlPoints.length;a<s;){var u=[a++],l=e.map(function(t){return function(e){return e.controlPoints[t[0]]}}(u)),h=Ne.rationalInterpCurve(l,t,!0);o.push(h.controlPoints),i=h.knots}return new V(n,t,r,i,o)},Ne.clonedCurve=function(e){return new De(e.degree,e.knots.slice(),e.controlPoints.map(function(e){return e.slice()}))},Ne.rationalBezierCurve=function(e,t){for(var n=e.length-1,r=[],i=0,o=1+n;i<o;){i++;r.push(0)}for(var a=0,s=1+n;a<s;){a++;r.push(1)}return null==t&&(t=Ve.rep(e.length,1)),new De(n,r,Ce.homogenize1d(e,t))},Ne.fourPointSurface=function(e,t,n,r,i){null==i&&(i=3);for(var o=i,a=[],s=0,u=i+1;s<u;){for(var l=s++,h=[],c=0,f=i+1;c<f;){var v=c++,_=1-l/o,d=Ve.lerp(_,e,t),p=Ve.lerp(_,r,n),m=Ve.lerp(1-v/o,d,p);m.push(1),h.push(m)}a.push(h)}var g=Ve.rep(i+1,0),b=Ve.rep(i+1,1);return new V(i,i,g.concat(b),g.concat(b),a)},Ne.ellipseArc=function(e,t,n,r,i){var o=Ve.norm(t),a=Ve.norm(n);t=Ve.normalized(t),n=Ve.normalized(n),i<r&&(i=2*Math.PI+r);var s=i-r,u=0,l=s/(u=s<=Math.PI/2?1:s<=Math.PI?2:s<=3*Math.PI/2?3:4),h=Math.cos(l/2),c=Ve.add(e,Ve.add(Ve.mul(o*Math.cos(r),t),Ve.mul(a*Math.sin(r),n))),f=Ve.sub(Ve.mul(Math.cos(r),n),Ve.mul(Math.sin(r),t)),v=[],_=Ve.zeros1d(2*u+3),d=0,p=r,m=Ve.zeros1d(2*u);v[0]=c;for(var g=m[0]=1,b=u+1;g<b;){var y=g++;p+=l;var w=Ve.add(e,Ve.add(Ve.mul(o*Math.cos(p),t),Ve.mul(a*Math.sin(p),n)));m[d+2]=1,v[d+2]=w;var S=Ve.sub(Ve.mul(Math.cos(p),n),Ve.mul(Math.sin(p),t)),k=Me.rays(c,Ve.mul(1/Ve.norm(f),f),w,Ve.mul(1/Ve.norm(S),S)),P=Ve.add(c,Ve.mul(k.u0,f));m[d+1]=h,v[d+1]=P,d+=2,y<u&&(c=w,f=S)}for(var x=2*u+1,C=0;C<3;){var M=C++;_[M]=0,_[M+x]=1}switch(u){case 2:_[3]=_[4]=.5;break;case 3:_[3]=_[4]=.3333333333333333,_[5]=_[6]=.6666666666666666;break;case 4:_[3]=_[4]=.25,_[5]=_[6]=.5,_[7]=_[8]=.75}return new De(2,_,Ce.homogenize1d(v,m))},Ne.arc=function(e,t,n,r,i,o){return Ne.ellipseArc(e,Ve.mul(r,Ve.normalized(t)),Ve.mul(r,Ve.normalized(n)),i,o)},Ne.polyline=function(e){for(var t=[0,0],n=0,r=0,i=e.length-1;r<i;){var o=r++;n+=Ve.dist(e[o],e[1+o]),t.push(n)}t.push(n),t=Ve.mul(1/n,t);for(var a=[],s=0,u=e.length;s<u;){s++;a.push(1)}var l=a;return new De(1,t,Ce.homogenize1d(e.slice(0),l))},Ne.extrudedSurface=function(e,t,n){for(var r=[[],[],[]],i=[[],[],[]],o=Ce.dehomogenize1d(n.controlPoints),a=Ce.weight1d(n.controlPoints),s=Ve.mul(t,e),u=Ve.mul(.5*t,e),l=0,h=o.length;l<h;){var c=l++;r[2][c]=o[c],r[1][c]=Ve.add(u,o[c]),r[0][c]=Ve.add(s,o[c]),i[0][c]=a[c],i[1][c]=a[c],i[2][c]=a[c]}return new V(2,n.degree,[0,0,0,1,1,1],n.knots,Ce.homogenize2d(r,i))},Ne.cylindricalSurface=function(e,t,n,r,i){var o=Ve.cross(e,t),a=(Math.PI,Ne.arc(n,t,o,i,0,2*Math.PI));return Ne.extrudedSurface(e,r,a)},Ne.revolvedSurface=function(e,t,n,r){var i,o,a=Ce.dehomogenize1d(e.controlPoints),s=Ce.weight1d(e.controlPoints);r<=Math.PI/2?(i=1,o=Ve.zeros1d(6+2*(i-1))):r<=Math.PI?(i=2,(o=Ve.zeros1d(6+2*(i-1)))[3]=o[4]=.5):r<=3*Math.PI/2?(i=3,(o=Ve.zeros1d(6+2*(i-1)))[3]=o[4]=.3333333333333333,o[5]=o[6]=.6666666666666666):(i=4,(o=Ve.zeros1d(6+2*(i-1)))[3]=o[4]=.25,o[5]=o[6]=.5,o[7]=o[8]=.75);for(var u=r/i,l=3+2*(i-1),h=0;h<3;){var c=h++;o[c]=0,o[l+c]=1}for(var f=Math.cos(u/2),v=0,_=Ve.zeros1d(i+1),d=Ve.zeros1d(i+1),p=Ve.zeros3d(2*i+1,a.length,3),m=Ve.zeros2d(2*i+1,a.length),g=1,b=i+1;g<b;){var y=g++;v+=u,d[y]=Math.cos(v),_[y]=Math.sin(v)}for(var w=0,S=a.length;w<S;){var k=w++,P=ye.rayClosestPoint(a[k],t,n),x=Ve.sub(a[k],P),C=Ve.norm(x),M=Ve.cross(n,x);C>D.EPSILON&&(x=Ve.mul(1/C,x),M=Ve.mul(1/C,M)),p[0][k]=a[k];var N=a[k];m[0][k]=s[k];for(var A=M,z=0,E=1,I=i+1;E<I;){var L=E++,T=0==C?P:Ve.add(P,Ve.add(Ve.mul(C*d[L],x),Ve.mul(C*_[L],M)));p[z+2][k]=T,m[z+2][k]=s[k];var B=Ve.sub(Ve.mul(d[L],M),Ve.mul(_[L],x));if(0==C)p[z+1][k]=P;else{var U=Me.rays(N,Ve.mul(1/Ve.norm(A),A),T,Ve.mul(1/Ve.norm(B),B)),R=Ve.add(N,Ve.mul(U.u0,A));p[z+1][k]=R}m[z+1][k]=f*s[k],z+=2,L<i&&(N=T,A=B)}}return new V(2,e.degree,o,e.knots,Ce.homogenize2d(p,m))},Ne.sphericalSurface=function(e,t,n,r){var i=Ne.arc(e,Ve.mul(-1,t),n,r,0,Math.PI);return Ne.revolvedSurface(i,e,t,2*Math.PI)},Ne.conicalSurface=function(e,t,n,r,i){var o=2*Math.PI,a=[Ve.add(n,Ve.mul(r,e)),Ve.add(n,Ve.mul(i,t))],s=new De(1,[0,0,1,1],Ce.homogenize1d(a,[1,1]));return Ne.revolvedSurface(s,n,e,o)},Ne.rationalInterpCurve=function(e,t,n,r,i){if(null==n&&(n=!1),null==t&&(t=3),e.length<t+1)throw new se("You need to supply at least degree + 1 points! You only supplied "+e.length+" points.");for(var o=[0],a=1,s=e.length;a<s;){var u=a++,l=Ve.norm(Ve.sub(e[u],e[u-1])),h=o[o.length-1];o.push(h+l)}for(var c=o[o.length-1],f=0,v=o.length;f<v;){o[f++]/=c}for(var _=Ve.rep(t+1,0),d=null!=r&&null!=i,p=d?0:1,m=d?o.length-t+1:o.length-t;p<m;){for(var g=p++,b=0,y=0,w=t;y<w;){b+=o[g+y++]}_.push(1/t*b)}for(var S=_.concat(Ve.rep(t+1,1)),k=[],P=d?e.length+1:e.length-1,x=d?e.length-(t-1):e.length-(t+1),C=0;C<o.length;){var M=o[C];++C;var N=Ce.knotSpanGivenN(P,t,M,S),A=Ce.basisFunctionsGivenKnotSpanIndex(N,M,t,S),z=N-t,E=Ve.zeros1d(z),I=Ve.zeros1d(x-z);k.push(E.concat(A).concat(I))}if(d){var L=k[0].length-2,T=[-1,1].concat(Ve.zeros1d(L)),B=Ve.zeros1d(L).concat([-1,1]);Z.spliceAndInsert(k,1,0,T),Z.spliceAndInsert(k,k.length-1,0,B)}for(var U=e[0].length,R=[],D=(1-S[S.length-t-2])/t,V=S[t+1]/t,O=0,F=U;O<F;){var j,q=[O++];if(d){(j=[e[0][q[0]]]).push(V*r[q[0]]);for(var G=1,K=e.length-1;G<K;){var W=G++;j.push(e[W][q[0]])}j.push(D*i[q[0]]),j.push(Z.last(e)[q[0]])}else j=e.map(function(t){return function(e){return e[t[0]]}}(q));var H=fe.solve(k,j);R.push(H)}var Q=fe.transpose(R);if(!n){var Y=Ve.rep(Q.length,1);Q=Ce.homogenize1d(Q,Y)}return new De(t,S,Q)};var Oe=e.eval.Modify=function(){};(r["verb.eval.Modify"]=Oe).__name__=["verb","eval","Modify"],Oe.curveReverse=function(e){return new De(e.degree,Oe.knotsReverse(e.knots),Z.reversed(e.controlPoints))},Oe.surfaceReverse=function(e,t){if(null==t&&(t=!1),t){for(var n=e.degreeU,r=e.degreeV,i=e.knotsU,o=Oe.knotsReverse(e.knotsV),a=[],s=0,u=e.controlPoints;s<u.length;){var l=u[s];++s,a.push(Z.reversed(l))}return new V(n,r,i,o,a)}return new V(e.degreeU,e.degreeV,Oe.knotsReverse(e.knotsU),e.knotsV,Z.reversed(e.controlPoints))},Oe.knotsReverse=function(e){for(var t=Z.first(e),n=(Z.last(e),[t]),r=e.length,i=1,o=r;i<o;){var a=i++;n.push(n[a-1]+(e[r-a]-e[r-a-1]))}return n},Oe.unifyCurveKnotVectors=function(e){e=e.map(Ne.clonedCurve);for(var t=N.fold(e,function(e,t){return Oe.imax(e.degree,t)},0),n=0,r=e.length;n<r;){var i=n++;e[i].degree<t&&(e[i]=Oe.curveElevateDegree(e[i],t))}for(var o=[],a=0;a<e.length;){var s=e[a];++a,o.push(new z(Z.first(s.knots),Z.last(s.knots)))}for(var u=o,l=0,h=e.length;l<h;){var c=l++,f=[u[c].min],v=e[c].knots,_=function(t){return function(e){return e-t[0]}}(f);e[c].knots=v.map(_)}for(var d=u.map(function(e){return e.max-e.min}),p=N.fold(d,function(e,t){return Math.max(e,t)},0),m=0,g=e.length;m<g;){var b=m++,y=[p/d[b]],w=e[b].knots,S=function(t){return function(e){return e*t[0]}}(y);e[b].knots=w.map(S)}for(var k=N.fold(e,function(e,t){return Ve.sortedSetUnion(e.knots,t)},[]),P=0,x=e.length;P<x;){var C=P++,M=Ve.sortedSetSub(k,e[C].knots);0==M.length&&(e[C]=e[C]),e[C]=Oe.curveKnotRefine(e[C],M)}return e},Oe.imin=function(e,t){return e<t?e:t},Oe.imax=function(e,t){return t<e?e:t},Oe.curveElevateDegree=function(e,t){if(t<=e.degree)return e;var n=e.knots.length-e.degree-2,r=e.degree,i=e.knots,o=e.controlPoints,a=t-e.degree,s=e.controlPoints[0].length,u=Ve.zeros2d(r+a+1,r+1),l=[],h=[],c=[],f=n+r+1,v=t,_=Math.floor(v/2),d=[],p=[];u[0][0]=1;for(var m=u[v][r]=1,g=_+1;m<g;)for(var b=m++,y=1/Re.get(v,b),w=Oe.imin(r,b),S=Oe.imax(0,b-a),k=w+1;S<k;){var P=S++;u[b][P]=y*Re.get(r,P)*Re.get(a,b-P)}for(var x=_+1,C=v;x<C;)for(var M=x++,N=Oe.imin(r,M),A=Oe.imax(0,M-a),z=N+1;A<z;){var E=A++;u[M][E]=u[v-M][r-E]}var I=v,L=v+1,T=-1,B=r,U=r+1,R=1,D=i[0];d[0]=o[0];for(var V=0,O=v+1;V<O;){p[V++]=D}for(var F=0,j=r+1;F<j;){var q=F++;l[q]=o[q]}for(;U<f;){for(var G=U;U<f&&i[U]==i[U+1];)++U;var K=U-G+1,W=i[U],H=T;T=r-K;var Q=0<H?Math.floor((H+2)/2):1,Y=0<T?Math.floor(v-(T+1)/2):v;if(0<T){for(var Z=W-D,X=[],$=r;K<$;)X[$-K-1]=Z/(i[B+$]-D),--$;for(var J=1,ee=T+1;J<ee;){for(var te=J++,ne=T-te,re=K+te,ie=r;re<=ie;)l[ie]=Ve.add(Ve.mul(X[ie-re],l[ie]),Ve.mul(1-X[ie-re],l[ie-1])),--ie;c[ne]=l[r]}}for(var oe=Q,ae=v+1;oe<ae;){var se=oe++;h[se]=Ve.zeros1d(s);for(var ue=Oe.imin(r,se),le=Oe.imax(0,se-a),he=ue+1;le<he;){var ce=le++;h[se]=Ve.add(h[se],Ve.mul(u[se][ce],l[ce]))}}if(1<H)for(var fe=L-2,ve=L,_e=W-D,de=(W-p[L-1])/_e,pe=1,me=H;pe<me;){for(var ge=pe++,be=fe,ye=ve,we=ye-L+1;ge<ye-be;){if(be<R){var Se=(W-p[be])/(D-p[be]);d[be]=Ve.lerp(Se,d[be],d[be-1])}if(Q<=ye){if(ye-ge<=L-v+H){var ke=(W-p[ye-ge])/_e;h[we]=Ve.lerp(ke,h[we],h[we+1])}}else h[we]=Ve.lerp(de,h[we],h[we+1]);++be,--ye,--we}--fe,++ve}if(B!=r)for(var Pe=0,xe=v-H;Pe<xe;){Pe++;p[L]=D,++L}for(var Ce=Q,Me=Y+1;Ce<Me;){var Ne=Ce++;d[R]=h[Ne],++R}if(U<f){for(var Ae=0,ze=T;Ae<ze;){var Ee=Ae++;l[Ee]=c[Ee]}for(var Ie=T,Le=r+1;Ie<Le;){var Te=Ie++;l[Te]=o[U-r+Te]}B=U,++U,D=W}else for(var Be=0,Ue=v+1;Be<Ue;){p[L+Be++]=W}}return I-v-1,new De(t,p,d)},Oe.rationalSurfaceTransform=function(e,t){for(var n=Ce.dehomogenize2d(e.controlPoints),r=0,i=n.length;r<i;)for(var o=r++,a=0,s=n[o].length;a<s;){var u=a++,l=n[o][u];l.push(1),n[o][u]=fe.dot(t,l).slice(0,l.length-1)}return new V(e.degreeU,e.degreeV,e.knotsU.slice(),e.knotsV.slice(),Ce.homogenize2d(n,Ce.weight2d(e.controlPoints)))},Oe.rationalCurveTransform=function(e,t){for(var n=Ce.dehomogenize1d(e.controlPoints),r=0,i=n.length;r<i;){var o=r++,a=n[o];a.push(1),n[o]=fe.dot(t,a).slice(0,a.length-1)}return new De(e.degree,e.knots.slice(),Ce.homogenize1d(n,Ce.weight1d(e.controlPoints)))},Oe.surfaceKnotRefine=function(e,t,n){var r,i,o,a=[];i=n?(o=e.controlPoints,r=e.knotsV,e.degreeV):(o=fe.transpose(e.controlPoints),r=e.knotsU,e.degreeU);for(var s=null,u=0;u<o.length;){var l=o[u];++u,s=Oe.curveKnotRefine(new De(i,r,l),t),a.push(s.controlPoints)}var h=s.knots;return n?new V(e.degreeU,e.degreeV,e.knotsU.slice(),h,a):(a=fe.transpose(a),new V(e.degreeU,e.degreeV,h,e.knotsV.slice(),a))},Oe.decomposeCurveIntoBeziers=function(e){for(var t=e.degree,n=e.controlPoints,r=e.knots,i=we.knotMultiplicities(r),o=t+1,a=0;a<i.length;){var s=i[a];if(++a,s.mult<o){var u=Ve.rep(o-s.mult,s.knot),l=Oe.curveKnotRefine(new De(t,r,n),u);r=l.knots,n=l.controlPoints}}r.length;for(var h=2*o,c=[],f=0;f<n.length;){var v=r.slice(f,f+h),_=n.slice(f,f+o);c.push(new De(t,v,_)),f+=o}return c},Oe.curveKnotRefine=function(e,t){if(0==t.length)return Ne.clonedCurve(e);for(var n=e.degree,r=e.controlPoints,i=e.knots,o=r.length-1,a=o+n+1,s=t.length-1,u=Ce.knotSpan(n,t[0],i),l=Ce.knotSpan(n,t[s],i),h=[],c=[],f=0,v=u-n+1;f<v;){var _=f++;h[_]=r[_]}for(var d=l-1,p=1+o;d<p;){var m=d++;h[m+s+1]=r[m]}for(var g=0,b=u+1;g<b;){var y=g++;c[y]=i[y]}for(var w=l+n,S=a+1;w<S;){var k=w++;c[k+s+1]=i[k]}for(var P=l+n-1,x=l+n+s,C=s;0<=C;){for(;t[C]<=i[P]&&u<P;)h[x-n-1]=r[P-n-1],c[x]=i[P],--x,--P;h[x-n-1]=h[x-n];for(var M=1,N=n+1;M<N;){var A=M++,z=x-n+A,E=c[x+A]-t[C];Math.abs(E)<D.EPSILON?h[z-1]=h[z]:(E/=c[x+A]-i[P-n+A],h[z-1]=Ve.add(Ve.mul(E,h[z-1]),Ve.mul(1-E,h[z])))}c[x]=t[C],--x,--C}return new De(n,c,h)},Oe.curveKnotInsert=function(e,t,n){for(var r=e.degree,i=e.controlPoints,o=e.knots,a=i.length,s=Ce.knotSpan(r,t,o),u=[],l=[],h=[],c=1,f=s+1;c<f;){var v=c++;l[v]=o[v]}for(var _=1,d=n+1;_<d;){l[s+_++]=t}for(var p=s+1,m=o.length;p<m;){var g=p++;l[g+n]=o[g]}for(var b=0,y=s-r+1;b<y;){var w=b++;h[w]=i[w]}for(var S=s-0,k=a;S<k;){var P=S++;h[P+n]=i[P]}for(var x=0,C=r-0+1;x<C;){var M=x++;u[M]=i[s-r+M]}for(var N=0,A=0,z=1,E=n+1;z<E;){var I=z++;N=s-r+I;for(var L=0,T=r-I-0+1;L<T;){var B=L++;A=(t-o[N+B])/(o[B+s+1]-o[N+B]),u[B]=Ve.add(Ve.mul(A,u[1+B]),Ve.mul(1-A,u[B]))}h[N]=u[0],h[s+n-I-0]=u[r-I-0]}for(var U=N+1,R=s-0;U<R;){var D=U++;h[D]=u[D-N]}return new De(r,l,h)};var Ae=e.eval.Tess=function(){};(r["verb.eval.Tess"]=Ae).__name__=["verb","eval","Tess"],Ae.rationalCurveRegularSample=function(e,t,n){return Ae.rationalCurveRegularSampleRange(e,e.knots[0],Z.last(e.knots),t,n)},Ae.rationalCurveRegularSampleRange=function(e,t,n,r,i){r<1&&(r=2);for(var o=[],a=(n-t)/(r-1),s=0,u=0,l=r;u<l;){s=t+a*u++,i?o.push([s].concat(Ce.rationalCurvePoint(e,s))):o.push(Ce.rationalCurvePoint(e,s))}return o},Ae.rationalCurveAdaptiveSample=function(e,t,n){if(null==n&&(n=!1),null==t&&(t=1e-6),1!=e.degree)return Ae.rationalCurveAdaptiveSampleRange(e,e.knots[0],Z.last(e.knots),t,n);if(n){for(var r=[],i=0,o=e.controlPoints.length;i<o;){var a=i++;r.push([e.knots[1+a]].concat(Ce.dehomogenize(e.controlPoints[a])))}return r}return e.controlPoints.map(Ce.dehomogenize)},Ae.rationalCurveAdaptiveSampleRange=function(e,t,n,r,i){var o=Ce.rationalCurvePoint(e,t),a=Ce.rationalCurvePoint(e,n),s=t+(n-t)*(.5+.2*Math.random()),u=Ce.rationalCurvePoint(e,s),l=Ve.sub(o,a),h=Ve.sub(o,u);if(Ve.dot(l,l)<r&&Ve.dot(h,h)>r||!ye.threePointsAreFlat(o,u,a,r)){var c=t+.5*(n-t),f=Ae.rationalCurveAdaptiveSampleRange(e,t,c,r,i),v=Ae.rationalCurveAdaptiveSampleRange(e,c,n,r,i);return f.slice(0,-1).concat(v)}return i?[[t].concat(o),[n].concat(a)]:[o,a]},Ae.rationalSurfaceNaive=function(e,t,n){t<1&&(t=1),n<1&&(n=1);e.degreeU,e.degreeV,e.controlPoints;for(var r=e.knotsU,i=e.knotsV,o=(Z.last(r)-r[0])/t,a=(Z.last(i)-i[0])/n,s=[],u=[],l=[],h=0,c=t+1;h<c;)for(var f=h++,v=0,_=n+1;v<_;){var d=f*o,p=v++*a;u.push([d,p]);var m=Ce.rationalSurfaceDerivatives(e,d,p,1),g=m[0][0];s.push(g);var b=Ve.normalized(Ve.cross(m[1][0],m[0][1]));l.push(b)}for(var y=[],w=0,S=t;w<S;)for(var k=w++,P=0,x=n;P<x;){var C=P++,M=k*(n+1)+C,N=(1+k)*(n+1)+C,A=1+N,z=[M,N,A],E=[M,A,1+M];y.push(z),y.push(E)}return new I(y,s,l,u)},Ae.divideRationalSurfaceAdaptive=function(e,t){null==t&&(t=new ze),t.minDivsU=null!=t.minDivsU?t.minDivsU:1,t.minDivsU=null!=t.minDivsV?t.minDivsV:1,t.refine=null==t.refine||t.refine;for(var n=2*(e.controlPoints.length-1),r=2*(e.controlPoints[0].length-1),i=t.minDivsU=t.minDivsU>n?t.minDivsU:n,o=t.minDivsV=t.minDivsV>r?t.minDivsV:r,a=Z.last(e.knotsU),s=e.knotsU[0],u=Z.last(e.knotsV),l=e.knotsV[0],h=(a-s)/i,c=(u-l)/o,f=[],v=[],_=0,d=o+1;_<d;){for(var p=_++,m=[],g=0,b=i+1;g<b;){var y=s+h*g++,w=l+c*p,S=Ce.rationalSurfaceDerivatives(e,y,w,1),k=Ve.normalized(Ve.cross(S[0][1],S[1][0]));m.push(new j(S[0][0],k,[y,w],-1,Ve.isZero(k)))}v.push(m)}for(var P=0,x=o;P<x;)for(var C=P++,M=0,N=i;M<N;){var A=M++,z=[v[o-C-1][A],v[o-C-1][1+A],v[o-C][1+A],v[o-C][A]];f.push(new Ee(e,z))}if(!t.refine)return f;for(var E=0,I=o;E<I;)for(var L=E++,T=0,B=i;T<B;){var U=T++,R=L*i+U,D=Ae.north(R,L,U,i,o,f),V=Ae.east(R,L,U,i,o,f),O=Ae.south(R,L,U,i,o,f),F=Ae.west(R,L,U,i,o,f);f[R].neighbors=[O,V,D,F],f[R].divide(t)}return f},Ae.north=function(e,t,n,r,i,o){return 0==t?null:o[e-r]},Ae.south=function(e,t,n,r,i,o){return t==i-1?null:o[e+r]},Ae.east=function(e,t,n,r,i,o){return n==r-1?null:o[e+1]},Ae.west=function(e,t,n,r,i,o){return 0==n?null:o[e-1]},Ae.triangulateAdaptiveRefinementNodeTree=function(e){for(var t=I.empty(),n=0;n<e.length;){var r=e[n];++n,r.triangulate(t)}return t},Ae.rationalSurfaceAdaptive=function(e,t){t=null!=t?t:new ze;var n=Ae.divideRationalSurfaceAdaptive(e,t);return Ae.triangulateAdaptiveRefinementNodeTree(n)};var ze=e.core.AdaptiveRefinementOptions=function(){this.minDivsV=1,this.minDivsU=1,this.refine=!0,this.maxDepth=10,this.minDepth=0,this.normTol=.025};(r["verb.eval.AdaptiveRefinementOptions"]=ze).__name__=["verb","eval","AdaptiveRefinementOptions"],ze.prototype={__class__:ze};var Ee=e.core.AdaptiveRefinementNode=function(e,t,n){if(this.srf=e,this.neighbors=null==n?[null,null,null,null]:n,this.corners=t,null==this.corners){var r=e.knotsU[0],i=Z.last(e.knotsU),o=e.knotsV[0],a=Z.last(e.knotsV);this.corners=[j.fromUv(r,o),j.fromUv(i,o),j.fromUv(i,a),j.fromUv(r,a)]}};(r["verb.eval.AdaptiveRefinementNode"]=Ee).__name__=["verb","eval","AdaptiveRefinementNode"],Ee.prototype={isLeaf:function(){return null==this.children},center:function(){return null!=this.centerPoint?this.centerPoint:this.evalSrf(this.u05,this.v05)},evalCorners:function(){this.u05=(this.corners[0].uv[0]+this.corners[2].uv[0])/2,this.v05=(this.corners[0].uv[1]+this.corners[2].uv[1])/2;for(var e=0;e<4;){var t=e++;if(null==this.corners[t].point){var n=this.corners[t];this.evalSrf(n.uv[0],n.uv[1],n)}}},evalSrf:function(e,t,n){var r=Ce.rationalSurfaceDerivatives(this.srf,e,t,1),i=r[0][0],o=Ve.cross(r[0][1],r[1][0]),a=Ve.isZero(o);return a||(o=Ve.normalized(o)),null!=n?(n.degen=a,n.point=i,n.normal=o,n):new j(i,o,[e,t],-1,a)},getEdgeCorners:function(e){if(this.isLeaf())return[this.corners[e]];if(this.horizontal)switch(e){case 0:return this.children[0].getEdgeCorners(0);case 1:return this.children[0].getEdgeCorners(1).concat(this.children[1].getEdgeCorners(1));case 2:return this.children[1].getEdgeCorners(2);case 3:return this.children[1].getEdgeCorners(3).concat(this.children[0].getEdgeCorners(3))}switch(e){case 0:return this.children[0].getEdgeCorners(0).concat(this.children[1].getEdgeCorners(0));case 1:return this.children[1].getEdgeCorners(1);case 2:return this.children[1].getEdgeCorners(2).concat(this.children[0].getEdgeCorners(2));case 3:return this.children[0].getEdgeCorners(3)}return null},getAllCorners:function(e){var t=[this.corners[e]];if(null==this.neighbors[e])return t;var n=this.neighbors[e].getEdgeCorners((e+2)%4),r=e%2,i=D.EPSILON,o=this,a=[function(e){return e.uv[0]>o.corners[0].uv[0]+i&&e.uv[0]<o.corners[2].uv[0]-i},function(e){return e.uv[1]>o.corners[0].uv[1]+i&&e.uv[1]<o.corners[2].uv[1]-i}],s=n.filter(a[r]);return s.reverse(),t.concat(s)},midpoint:function(e){if(null==this.midPoints&&(this.midPoints=[null,null,null,null]),null!=this.midPoints[e])return this.midPoints[e];switch(e){case 0:this.midPoints[0]=this.evalSrf(this.u05,this.corners[0].uv[1]);break;case 1:this.midPoints[1]=this.evalSrf(this.corners[1].uv[0],this.v05);break;case 2:this.midPoints[2]=this.evalSrf(this.u05,this.corners[2].uv[1]);break;case 3:this.midPoints[3]=this.evalSrf(this.corners[0].uv[0],this.v05)}return this.midPoints[e]},hasBadNormals:function(){return!!(this.corners[0].degen||this.corners[1].degen||this.corners[2].degen)||this.corners[3].degen},fixNormals:function(){for(var e=this.corners.length,t=0,n=e;t<n;){var r=t++;this.corners[r];if(this.corners[r].degen){var i=this.corners[(1+r)%e],o=this.corners[(3+r)%e];this.corners[r].normal=i.degen?o.normal:i.normal}}},shouldDivide:function(e,t){if(t<e.minDepth)return!0;if(t>=e.maxDepth)return!1;if(this.hasBadNormals())return this.fixNormals(),!1;if(this.splitVert=Ve.normSquared(Ve.sub(this.corners[0].normal,this.corners[1].normal))>e.normTol||Ve.normSquared(Ve.sub(this.corners[2].normal,this.corners[3].normal))>e.normTol,this.splitHoriz=Ve.normSquared(Ve.sub(this.corners[1].normal,this.corners[2].normal))>e.normTol||Ve.normSquared(Ve.sub(this.corners[3].normal,this.corners[0].normal))>e.normTol,this.splitVert||this.splitHoriz)return!0;var n=this.center();return Ve.normSquared(Ve.sub(n.normal,this.corners[0].normal))>e.normTol||Ve.normSquared(Ve.sub(n.normal,this.corners[1].normal))>e.normTol||Ve.normSquared(Ve.sub(n.normal,this.corners[2].normal))>e.normTol||Ve.normSquared(Ve.sub(n.normal,this.corners[3].normal))>e.normTol},divide:function(e){null==e&&(e=new ze),null==e.normTol&&(e.normTol=.085),null==e.minDepth&&(e.minDepth=0),null==e.maxDepth&&(e.maxDepth=10),this._divide(e,0,!0)},_divide:function(e,t,n){if(this.evalCorners(),this.shouldDivide(e,t)){if(++t,this.splitVert&&!this.splitHoriz?n=!1:!this.splitVert&&this.splitHoriz&&(n=!0),this.horizontal=n,this.horizontal){var r=[this.corners[0],this.corners[1],this.midpoint(1),this.midpoint(3)],i=[this.midpoint(3),this.midpoint(1),this.corners[2],this.corners[3]];this.children=[new Ee(this.srf,r),new Ee(this.srf,i)],this.children[0].neighbors=[this.neighbors[0],this.neighbors[1],this.children[1],this.neighbors[3]],this.children[1].neighbors=[this.children[0],this.neighbors[1],this.neighbors[2],this.neighbors[3]]}else{var o=[this.corners[0],this.midpoint(0),this.midpoint(2),this.corners[3]],a=[this.midpoint(0),this.corners[1],this.corners[2],this.midpoint(2)];this.children=[new Ee(this.srf,o),new Ee(this.srf,a)],this.children[0].neighbors=[this.neighbors[0],this.children[1],this.neighbors[2],this.neighbors[3]],this.children[1].neighbors=[this.neighbors[0],this.neighbors[1],this.neighbors[2],this.children[0]]}for(var s=0,u=this.children;s<u.length;){var l=u[s];++s,l._divide(e,t,!n)}}},triangulate:function(e){if(null==e&&(e=I.empty()),this.isLeaf())return this.triangulateLeaf(e);for(var t=0,n=this.children;t<n.length;){var r=n[t];if(++t,null==r)break;r.triangulate(e)}return e},triangulateLeaf:function(e){for(var t=e.points.length,n=[],r=[],i=0,o=0;o<4;){var a=o++,s=this.getAllCorners(a);2==s.length&&(i=1+a);for(var u=0,l=s.length;u<l;){var h=u++;n.push(s[h])}}for(var c=0;c<n.length;){var f=n[c];++c,-1==f.id?(e.uvs.push(f.uv),e.points.push(f.point),e.normals.push(f.normal),f.id=t,r.push(t),++t):r.push(f.id)}if(4==n.length)return e.faces.push([r[0],r[3],r[1]]),e.faces.push([r[3],r[2],r[1]]),e;if(5==n.length){var v=r.length;return e.faces.push([r[i],r[(i+2)%v],r[(i+1)%v]]),e.faces.push([r[(i+4)%v],r[(i+3)%v],r[i]]),e.faces.push([r[i],r[(i+3)%v],r[(i+2)%v]]),e}var _=this.center();e.uvs.push(_.uv),e.points.push(_.point),e.normals.push(_.normal);for(var d=e.points.length-1,p=0,m=n.length-1;p<n.length;)e.faces.push([d,r[p],r[m]]),m=p++;return e},__class__:Ee};var Ie=e.exe.Dispatcher=function(){};(r["verb.exe.Dispatcher"]=Ie).__name__=["verb","exe","Dispatcher"],Ie.init=function(){Ie._init||(Ie._workerPool=new Le(Ie.THREADS),Ie._init=!0)},Ie.dispatchMethod=function(e,t,n){Ie.init();var r=new _;return Ie._workerPool.addWork(te.getClassName(e),t,n,function(e){r.resolve(e)}),new m(r)};var Le=e.exe.WorkerPool=function(e,t){null==t&&(t="verb.js"),null==e&&(e=1),this._callbacks=new re,this._working=new re,this._pool=[],this._queue=[];for(var n=0,r=e;n<r;){var i;n++;try{i=new Worker(Le.basePath+t)}catch(e){i=new Worker(Le.basePath+t.substring(0,-3)+".min.js")}this._pool.push(i)}};(r["verb.exe.WorkerPool"]=Le).__name__=["verb","exe","WorkerPool"],Le.prototype={addWork:function(e,t,n,r){var i=new Te(e,t,n);this._callbacks.h[i.id]=r,this._queue.push(i),this.processQueue()},processQueue:function(){for(var r=this;0<this._queue.length&&0<this._pool.length;){var e=this._queue.shift(),t=[e.id],n=[this._pool.shift()];this._working.h[t[0]]=n[0],n[0].onmessage=function(t,n){return function(e){r._working.remove(n[0]),r._pool.push(t[0]);try{r._callbacks.h.hasOwnProperty(n[0])&&(r._callbacks.h[n[0]](e.data.result),r._callbacks.remove(n[0]))}catch(e){e instanceof se&&(e=e.val),console.log(e)}r.processQueue()}}(n,t),n[0].postMessage(e)}},__class__:Le};var Te=function(e,t,n){this.className=e,this.methodName=t,this.args=n,this.id=Te.uuid++};(r["verb.exe._WorkerPool.Work"]=Te).__name__=["verb","exe","_WorkerPool","Work"],Te.prototype={__class__:Te};function Be(){}(r["verb.geom.ICurve"]=Be).__name__=["verb","geom","ICurve"],Be.__interfaces__=[ge],Be.prototype={__class__:Be};var Ue=e.geom.NurbsCurve=function(e){this._data=ke.isValidNurbsCurveData(e)};(r["verb.geom.NurbsCurve"]=Ue).__name__=["verb","geom","NurbsCurve"],Ue.__interfaces__=[Be],Ue.byKnotsControlPointsWeights=function(e,t,n,r){return new Ue(new De(e,t.slice(),Ce.homogenize1d(n,r)))},Ue.byPoints=function(e,t){return null==t&&(t=3),new Ue(Ne.rationalInterpCurve(e,t))},Ue.__super__=k,Ue.prototype=i(k.prototype,{degree:function(){return this._data.degree},knots:function(){return this._data.knots.slice(0)},controlPoints:function(){return Ce.dehomogenize1d(this._data.controlPoints)},weights:function(){return Ce.weight1d(this._data.controlPoints)},asNurbs:function(){return new De(this.degree(),this.knots(),Ce.homogenize1d(this.controlPoints(),this.weights()))},clone:function(){return new Ue(this._data)},domain:function(){return new z(Z.first(this._data.knots),Z.last(this._data.knots))},transform:function(e){return new Ue(Oe.rationalCurveTransform(this._data,e))},transformAsync:function(e){return Ie.dispatchMethod(Oe,"rationalCurveTransform",[this._data,e]).then(function(e){return new Ue(e)})},point:function(e){return Ce.rationalCurvePoint(this._data,e)},pointAsync:function(e){return Ie.dispatchMethod(Ce,"rationalCurvePoint",[this._data,e])},tangent:function(e){return Ce.rationalCurveTangent(this._data,e)},tangentAsync:function(e){return Ie.dispatchMethod(Ce,"rationalCurveTangent",[this._data,e])},derivatives:function(e,t){return null==t&&(t=1),Ce.rationalCurveDerivatives(this._data,e,t)},derivativesAsync:function(e,t){return null==t&&(t=1),Ie.dispatchMethod(Ce,"rationalCurveDerivatives",[this._data,e,t])},closestPoint:function(e){return we.rationalCurveClosestPoint(this._data,e)},closestPointAsync:function(e){return Ie.dispatchMethod(we,"rationalCurveClosestPoint",[this._data,e])},closestParam:function(e){return we.rationalCurveClosestParam(this._data,e)},closestParamAsync:function(e){return Ie.dispatchMethod(we,"rationalCurveClosestParam",[this._data,e])},length:function(){return we.rationalCurveArcLength(this._data)},lengthAsync:function(){return Ie.dispatchMethod(we,"rationalCurveArcLength",[this._data])},lengthAtParam:function(e){return we.rationalCurveArcLength(this._data,e)},lengthAtParamAsync:function(){return Ie.dispatchMethod(we,"rationalCurveArcLength",[this._data])},paramAtLength:function(e,t){return we.rationalCurveParamAtArcLength(this._data,e,t)},paramAtLengthAsync:function(e,t){return Ie.dispatchMethod(we,"rationalCurveParamAtArcLength",[this._data,e,t])},divideByEqualArcLength:function(e){return Pe.rationalCurveByEqualArcLength(this._data,e)},divideByEqualArcLengthAsync:function(e){return Ie.dispatchMethod(Pe,"rationalCurveByEqualArcLength",[this._data,e])},divideByArcLength:function(e){return Pe.rationalCurveByArcLength(this._data,e)},divideByArcLengthAsync:function(e){return Ie.dispatchMethod(Pe,"rationalCurveByArcLength",[this._data,e])},split:function(e){return Pe.curveSplit(this._data,e).map(function(e){return new Ue(e)})},splitAsync:function(e){return Ie.dispatchMethod(Pe,"curveSplit",[this._data,e]).then(function(e){return e.map(function(e){return new Ue(e)})})},reverse:function(){return new Ue(Oe.curveReverse(this._data))},reverseAsync:function(){return Ie.dispatchMethod(Oe,"curveReverse",[this._data]).then(function(e){return new Ue(e)})},tessellate:function(e){return Ae.rationalCurveAdaptiveSample(this._data,e,!1)},tessellateAsync:function(e){return Ie.dispatchMethod(Ae,"rationalCurveAdaptiveSample",[this._data,e,!1])},__class__:Ue});var Fe=e.geom.Arc=function(e,t,n,r,i,o){Ue.call(this,Ne.arc(e,t,n,r,i,o)),this._center=e,this._xaxis=t,this._yaxis=n,this._radius=r,this._minAngle=i,this._maxAngle=o};(r["verb.geom.Arc"]=Fe).__name__=["verb","geom","Arc"],Fe.__super__=Ue,Fe.prototype=i(Ue.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},radius:function(){return this._radius},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Fe});var je=e.geom.BezierCurve=function(e,t){Ue.call(this,Ne.rationalBezierCurve(e,t))};(r["verb.geom.BezierCurve"]=je).__name__=["verb","geom","BezierCurve"],je.__super__=Ue,je.prototype=i(Ue.prototype,{__class__:je});var qe=e.geom.Circle=function(e,t,n,r){Fe.call(this,e,t,n,r,0,2*Math.PI)};(r["verb.geom.Circle"]=qe).__name__=["verb","geom","Circle"],qe.__super__=Fe,qe.prototype=i(Fe.prototype,{__class__:qe});function Ge(){}(r["verb.geom.ISurface"]=Ge).__name__=["verb","geom","ISurface"],Ge.__interfaces__=[ge],Ge.prototype={__class__:Ge};var Ke=e.geom.NurbsSurface=function(e){this._data=ke.isValidNurbsSurfaceData(e)};(r["verb.geom.NurbsSurface"]=Ke).__name__=["verb","geom","NurbsSurface"],Ke.__interfaces__=[Ge],Ke.byKnotsControlPointsWeights=function(e,t,n,r,i,o){return new Ke(new V(e,t,n,r,Ce.homogenize2d(i,o)))},Ke.byCorners=function(e,t,n,r){return new Ke(Ne.fourPointSurface(e,t,n,r))},Ke.byLoftingCurves=function(e,t){for(var n=[],r=0;r<e.length;){var i=e[r];++r,n.push(i.asNurbs())}return new Ke(Ne.loftedSurface(n,t))},Ke.__super__=k,Ke.prototype=i(k.prototype,{degreeU:function(){return this._data.degreeU},degreeV:function(){return this._data.degreeV},knotsU:function(){return this._data.knotsU.slice(0)},knotsV:function(){return this._data.knotsV.slice(0)},controlPoints:function(){return Ce.dehomogenize2d(this._data.controlPoints)},weights:function(){return Ce.weight2d(this._data.controlPoints)},asNurbs:function(){return new V(this.degreeU(),this.degreeV(),this.knotsU(),this.knotsV(),Ce.homogenize2d(this.controlPoints(),this.weights()))},clone:function(){return new Ke(this.asNurbs())},domainU:function(){return new z(Z.first(this._data.knotsU),Z.last(this._data.knotsU))},domainV:function(){return new z(Z.first(this._data.knotsV),Z.last(this._data.knotsV))},point:function(e,t){return Ce.rationalSurfacePoint(this._data,e,t)},pointAsync:function(e,t){return Ie.dispatchMethod(Ce,"rationalSurfacePoint",[this._data,e,t])},normal:function(e,t){return Ce.rationalSurfaceNormal(this._data,e,t)},normalAsync:function(e,t){return Ie.dispatchMethod(Ce,"rationalSurfaceNormal",[this._data,e,t])},derivatives:function(e,t,n){return null==n&&(n=1),Ce.rationalSurfaceDerivatives(this._data,e,t,n)},derivativesAsync:function(e,t,n){return null==n&&(n=1),Ie.dispatchMethod(Ce,"rationalSurfaceDerivatives",[this._data,e,t,n])},closestParam:function(e){return we.rationalSurfaceClosestParam(this._data,e)},closestParamAsync:function(e){return Ie.dispatchMethod(we,"rationalSurfaceClosestParam",[this._data,e])},closestPoint:function(e){return we.rationalSurfaceClosestPoint(this._data,e)},closestPointAsync:function(e){return Ie.dispatchMethod(we,"rationalSurfaceClosestPoint",[this._data,e])},split:function(e,t){return null==t&&(t=!1),Pe.surfaceSplit(this._data,e,t).map(function(e){return new Ke(e)})},splitAsync:function(e,t){return null==t&&(t=!1),Ie.dispatchMethod(Pe,"surfaceSplit",[this._data,e,t]).then(function(e){return e.map(function(e){return new Ke(e)})})},reverse:function(e){return null==e&&(e=!1),new Ke(Oe.surfaceReverse(this._data,e))},reverseAsync:function(e){return null==e&&(e=!1),Ie.dispatchMethod(Oe,"surfaceReverse",[this._data,e]).then(function(e){return new Ke(e)})},isocurve:function(e,t){return null==t&&(t=!1),new Ue(Ne.surfaceIsocurve(this._data,e,t))},isocurveAsync:function(e,t){return null==t&&(t=!1),Ie.dispatchMethod(Ne,"surfaceIsocurve",[this._data,e,t]).then(function(e){return new Ue(e)})},boundaries:function(e){return Ne.surfaceBoundaryCurves(this._data).map(function(e){return new Ue(e)})},boundariesAsync:function(e){return Ie.dispatchMethod(Ne,"surfaceBoundaryCurves",[this._data]).then(function(e){return e.map(function(e){return new Ue(e)})})},tessellate:function(e){return Ae.rationalSurfaceAdaptive(this._data,e)},tessellateAsync:function(e){return Ie.dispatchMethod(Ae,"rationalSurfaceAdaptive",[this._data,e])},transform:function(e){return new Ke(Oe.rationalSurfaceTransform(this._data,e))},transformAsync:function(e){return Ie.dispatchMethod(Oe,"rationalSurfaceTransform",[this._data,e]).then(function(e){return new Ke(e)})},__class__:Ke});var We=e.geom.ConicalSurface=function(e,t,n,r,i){Ke.call(this,Ne.conicalSurface(e,t,n,r,i)),this._axis=e,this._xaxis=t,this._base=n,this._height=r,this._radius=i};(r["verb.geom.ConicalSurface"]=We).__name__=["verb","geom","ConicalSurface"],We.__super__=Ke,We.prototype=i(Ke.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:We});var He=e.geom.CylindricalSurface=function(e,t,n,r,i){Ke.call(this,Ne.cylindricalSurface(e,t,n,r,i)),this._axis=e,this._xaxis=t,this._base=n,this._height=r,this._radius=i};(r["verb.geom.CylindricalSurface"]=He).__name__=["verb","geom","CylindricalSurface"],He.__super__=Ke,He.prototype=i(Ke.prototype,{axis:function(){return this._axis},xaxis:function(){return this._xaxis},base:function(){return this._base},height:function(){return this._height},radius:function(){return this._radius},__class__:He});var Qe=e.geom.EllipseArc=function(e,t,n,r,i){Ue.call(this,Ne.ellipseArc(e,t,n,r,i)),this._center=e,this._xaxis=t,this._yaxis=n,this._minAngle=r,this._maxAngle=i};(r["verb.geom.EllipseArc"]=Qe).__name__=["verb","geom","EllipseArc"],Qe.__super__=Ue,Qe.prototype=i(Ue.prototype,{center:function(){return this._center},xaxis:function(){return this._xaxis},yaxis:function(){return this._yaxis},minAngle:function(){return this._minAngle},maxAngle:function(){return this._maxAngle},__class__:Qe});var Ye=e.geom.Ellipse=function(e,t,n){Qe.call(this,e,t,n,0,2*Math.PI)};(r["verb.geom.Ellipse"]=Ye).__name__=["verb","geom","Ellipse"],Ye.__super__=Qe,Ye.prototype=i(Qe.prototype,{__class__:Ye});var Ze=e.geom.ExtrudedSurface=function(e,t){Ke.call(this,Ne.extrudedSurface(Ve.normalized(t),Ve.norm(t),e.asNurbs())),this._profile=e,this._direction=t};(r["verb.geom.ExtrudedSurface"]=Ze).__name__=["verb","geom","ExtrudedSurface"],Ze.__super__=Ke,Ze.prototype=i(Ke.prototype,{profile:function(){return this._profile},direction:function(){return this._direction},__class__:Ze});var Xe=e.geom.Intersect=function(){};(r["verb.geom.Intersect"]=Xe).__name__=["verb","geom","Intersect"],Xe.curves=function(e,t,n){return null==n&&(n=.001),Me.curves(e.asNurbs(),t.asNurbs(),n)},Xe.curvesAsync=function(e,t,n){return null==n&&(n=.001),Ie.dispatchMethod(Me,"curves",[e.asNurbs(),t.asNurbs(),n])},Xe.curveAndSurface=function(e,t,n){return null==n&&(n=.001),Me.curveAndSurface(e.asNurbs(),t.asNurbs(),n)},Xe.curveAndSurfaceAsync=function(e,t,n){return null==n&&(n=.001),Ie.dispatchMethod(Me,"curveAndSurface",[e.asNurbs(),t.asNurbs(),n])},Xe.surfaces=function(e,t,n){return null==n&&(n=.001),Me.surfaces(e.asNurbs(),t.asNurbs(),n).map(function(e){return new Ue(e)})},Xe.surfacesAsync=function(e,t,n){return null==n&&(n=.001),Ie.dispatchMethod(Me,"surfaces",[e.asNurbs(),t.asNurbs(),n]).then(function(e){return e.map(function(e){return new Ue(e)})})};var $e=e.geom.Line=function(e,t){Ue.call(this,Ne.polyline([e,t])),this._start=e,this._end=t};(r["verb.geom.Line"]=$e).__name__=["verb","geom","Line"],$e.__super__=Ue,$e.prototype=i(Ue.prototype,{start:function(){return this._start},end:function(){return this._end},__class__:$e});var Je=e.geom.RevolvedSurface=function(e,t,n,r){Ke.call(this,Ne.revolvedSurface(e.asNurbs(),t,n,r)),this._profile=e,this._center=t,this._axis=n,this._angle=r};(r["verb.geom.RevolvedSurface"]=Je).__name__=["verb","geom","RevolvedSurface"],Je.__super__=Ke,Je.prototype=i(Ke.prototype,{profile:function(){return this._profile},center:function(){return this._center},axis:function(){return this._center},angle:function(){return this._angle},__class__:Je});var et=e.geom.SphericalSurface=function(e,t){Ke.call(this,Ne.sphericalSurface(e,[0,0,1],[1,0,0],t)),this._center=e,this._radius=t};(r["verb.geom.SphericalSurface"]=et).__name__=["verb","geom","SphericalSurface"],et.__super__=Ke,et.prototype=i(Ke.prototype,{center:function(){return this._center},radius:function(){return this._radius},__class__:et});var tt=e.geom.SweptSurface=function(e,t){Ke.call(this,Ne.rationalTranslationalSurface(e.asNurbs(),t.asNurbs())),this._profile=e,this._rail=t};function nt(e){return e instanceof Array?function(){return J.iter(e)}:"function"==typeof e.iterator?ot(e,e.iterator):e.iterator}(r["verb.geom.SweptSurface"]=tt).__name__=["verb","geom","SweptSurface"],tt.__super__=Ke,tt.prototype=i(Ke.prototype,{profile:function(){return this._profile},rail:function(){return this._rail},__class__:tt});var rt,it=0;function ot(e,t){return null==t?null:(null==t.__id__&&(t.__id__=it++),null==e.hx__closures__?e.hx__closures__={}:n=e.hx__closures__[t.__id__],null==n&&((n=function(){return n.method.apply(n.scope,arguments)}).scope=e,n.method=t,e.hx__closures__[t.__id__]=n),n);var n}r.Math=Math,String.prototype.__class__=r.String=String,String.__name__=["String"],r.Array=Array,Array.__name__=["Array"],Date.prototype.__class__=r.Date=Date,Date.__name__=["Date"];var at=r.Int={__name__:["Int"]},st=r.Dynamic={__name__:["Dynamic"]},ut=r.Float=Number;ut.__name__=["Float"];var lt=r.Bool=Boolean;lt.__ename__=["Bool"];var ht=r.Class={__name__:["Class"]},ct={},ft={},vt=t.ArrayBuffer||f;null==vt.prototype.slice&&(vt.prototype.slice=f.sliceImpl);var _t=t.Uint8Array||v._new;K.USE_CACHE=!1,K.USE_ENUM_INDEX=!1,K.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",ne.DEFAULT_RESOLVER=new h,ne.BASE64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%:",ie.count=0,W.__toStr={}.toString,v.BYTES_PER_ELEMENT=1,b.queue=new ee,Re.memo=new re,D.TOLERANCE=1e-6,D.EPSILON=1e-10,D.VERSION="2.0.0",we.Tvalues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],we.Cvalues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Ie.THREADS=1,Ie._init=!1,Le.basePath="",Te.uuid=0,w.main()}("undefined"!=typeof exports?exports:void 0!==n?n:"undefined"!=typeof self?self:this,void 0!==n?n:void 0!==r?r:"undefined"!=typeof self?self:this),{}});